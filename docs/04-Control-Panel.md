
# EdgeBox 控制面板 - V2 技术规范 (更新版)

本文档为 EdgeBox 控制面板 V2 版本的技术实现规范，旨在为前端开发提供清晰的布局、内容、状态及接口约定。

## 1\. 核心理念与统一口径

新版面板的核心是**信息分层**与**状态清晰**。通过模块化的卡片布局，将不同维度的数据进行逻辑隔离，为用户提供更聚焦、更有条理的视觉体验。

### 1.1 术语与命名（统一口径）

  * **通用术语**: 使用“出站”而非“出口”。
  * **卡片标题**: `网络身份配置`
  * **出站模式枚举**: `直连` (Direct), `全代理` (Full-Proxy), `混合` (Shunt)
  * **证书类型**: `Let's Encrypt`, `自签名`
  * **空值显示**:
      * 卡片层空值: 统一显示 `—`
      * 详情弹窗空值: 对应字段置 `—` 或 `未知`
      * 配置未设置或不存在: 统一显示 `(无)`

## 2\. 页面布局（12栅格系统）

页面采用响应式的12栅格系统进行布局。

  * **第一行: 主信息卡片**

      * `EdgeBox-企业级多协议节点` (占12列，整行)
          * 内部整合了“服务器负载与网络身份”、“核心服务”和“证书信息”三个逻辑区块。
          * 底部包含版本号、安装日期和更新时间。

  * **第二行: 核心配置**

      * `证书切换` (占4列)
      * `网络身份配置` (占8列)

  * **第三行: 协议详情**

      * `协议配置` (占12列，整行)

  * **第四行: 常用功能**

      * `订阅链接` (占12列)
      * `流量统计` (占12列)

## 3\. 卡片内容与交互规范

### 3.1 主信息卡片 (Main Info Card)

此卡片取代了旧有的顶部三卡片，作为页面的核心概览区。

  * **卡片标题**: `EdgeBox-企业级多协议节点`
  * **内部区块**:
      * **服务器负载与网络身份 (左)**
          * CPU: 进度条
          * 内存: 进度条
          * 服务器IP: `35.212.192.41`
          * 关联域名: `(无)`
      * **核心服务 (中)**
          * Nginx: `运行中` (状态徽章)
          * Xray: `运行中` (状态徽章)
          * Sing-box: `运行中` (状态徽章)
      * **证书信息 (右)**
          * 网络模式: `IP模式(自签名)`
          * 证书类型: `自签名证书`
          * 到期日期: `无`
          * 续期方式: `手动续期`
  * **卡片底部**: `版本号: 3.0.0 | 安装日期: 2025-09-11 | 更新时间: 2025/9/14 20:46:02`

### 3.2 证书切换 (Card)

  * **模式标签**: 卡片顶部放置两个标签：“自签证书”、“CA证书”，当前激活的模式标签显示为高亮状态。
  * **证书类型**: `Let's Encrypt` / `自签名`。
  * **绑定域名**: 显示域名字符串，如 `example.com`；若无则显示 `(无)`。
  * **续期方式**: `自动` / `手动`。
  * **到期日期**: 格式为 `YYYY-MM-DD`；自签名证书显示 `—`。

### 3.3 网络身份配置 (Composite Card)

此卡片信息经过精简，核心信息用于快速识别，详细信息则移入“详情”弹窗。

#### a) 卡片层显示 (On-Card Display)

  * **VPS出站IP**
      * **身份**: `直连` (徽章)
      * **出站IP**: `x.x.x.x` (带复制按钮)
      * **Geo**: `US-LA` (可选，国家/城市缩写徽章)
      * **IP质量**: `85分（良好）`，并附带 `详情` 链接。
  * **代理出站IP**
      * 规则同上，身份徽章为 `全代理`。
  * **分流出站**
      * **混合身份**: `白名单直连 + 其它代理`
      * **白名单**: `显示前 3 项，超出部分显示 +N`
      * **备注**: `注：HY2/TUIC 为 UDP 通道，VPS 直连`

#### b) “详情”弹窗显示 (Details Pop-up Display)

点击“IP质量”旁的“详情”链接后，弹窗内应展示以下完整信息：

  * **总览**: 分数 + 等级、最近检测时间
  * **身份信息**:
      * 出站IP
      * ASN/ISP
      * Geo (国家/城市全称)
  * **配置信息**:
      * 带宽限制 (上行/下行)
  * **质量细项**:
      * 网络类型 (住宅/IDC/移动)
      * rDNS
      * 黑名单命中数
      * 时延中位数
  * **结论**:
      * 判断依据 (要点列表)

### 3.4 协议配置 (Card)

  * **内容**: 沿用现有版本的大表格设计，包含`客户端配置`、`伪装效果`、`适用场景`、`运行状态`等列。
  * **去重**: 此卡片专注于协议本身，不再重复显示当前的出站分流状态。

### 3.5 订阅链接 & 流量统计 (Cards)

  * **布局与内容**: 功能和数据来源保持不变，仅需在新的12栅格体系下调整宽度和样式。

## 4\. 状态与空态规范

  * **加载中**: 所有卡片或卡片内的数据区域应显示骨架屏（Skeleton Screen）或灰色加载条。
  * **加载失败**: 在对应卡片的右上角显示一个红点角标。鼠标悬浮或点击后，显示具体的错误描述。
  * **空值/未配置**:
      * 卡片层空值: 统一显示 `—`
      * 详情弹窗空值: 对应字段置 `—` 或 `未知`
      * 某个配置项未设置（如绑定域名），显示 `(无)`。

## 5\. 后端 API 接口字段 (Data Contract)

主 `dashboard.json` 的 `networkIdentity` 字段依然需要提供完整数据，供“详情”弹窗使用。前端负责在卡片层仅展示部分精简信息。

```json
{
  // serverInfo, serverMetrics, coreServices, certificate 等字段保持不变
  "networkIdentity": {
    "vps": {
      "mode": "direct",
      "egressIp": "35.212.192.41",
      "asn": "AS15169",
      "isp": "Google",
      "geo": { "country": "US", "city": "Los Angeles" },
      "bandwidth": { "upMbps": 1000, "downMbps": 1000 },
      "ipQuality": { /* IP质量检测的完整JSON对象 */ }
    },
    "proxy": {
      "mode": "full-proxy",
      "egressIp": "91.203.36.10",
      "asn": "AS9009",
      "isp": "M247",
      "geo": { "country": "NL", "city": "Amsterdam" },
      "bandwidth": { "upMbps": 200, "downMbps": 200 },
      "ipQuality": { /* IP质量检测的完整JSON对象 */ }
    },
    "shunt": {
      "mode": "mixed",
      "whitelist": ["googlevideo.com", "ytimg.com", "..."],
      "note": "HY2/TUIC 为 UDP 通道，VPS 直连"
    }
  }
}
```

## 6\. V3 改动摘要 (供前端对照)

  * **[重构]** 顶部三个独立的概览卡片被**替换**为一个横跨整行的**主信息卡片**。
  * **[精简]** `网络身份配置`卡片**移除**了 `ASN/ISP` 和 `带宽限制` 字段，这些信息被移入“详情”弹窗。
  * **[优化]** `网络身份配置`卡片在视觉上**保留**了最核心的身份、IP、Geo（缩写）和质量评分，信息密度更合理。
  * **[维持]** 其余卡片（证书、协议、订阅、流量）的布局和功能基本不变，仅需适应新的行位置。
