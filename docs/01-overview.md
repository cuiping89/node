
# EdgeBox 控制面板 - V2 技术规范

本文档为 EdgeBox 控制面板 V2 版本的技术实现规范，旨在为前端开发提供清晰的布局、内容、状态及接口约定。

## 1\. 核心理念与统一口径

新版面板的核心是**信息分层**与**状态清晰**。通过模块化的卡片布局，将不同维度的数据进行逻辑隔离，为用户提供更聚焦、更有条理的视觉体验。

### 1.1 术语与命名（统一口径）

为确保前后端开发与最终用户体验的一致性，所有组件和状态的命名需严格遵守以下口径：

  * **通用术语**: 使用“出站”而非“出口”。
  * **卡片标题**:
      * `网络身份配置`
  * **出站模式枚举**:
      * `直连` (Direct)
      * `全代理` (Full-Proxy)
      * `混合` (Shunt)
  * **证书类型**:
      * `Let's Encrypt`
      * `自签名`
  * **空值显示**:
      * 数据获取中或未知: 统一显示 `—`
      * 配置未设置或不存在: 统一显示 显示 `未配置`或`无`

## 2\. 页面布局（12栅格系统）

页面采用响应式的12栅格系统进行布局，确保在不同屏幕尺寸下的兼容性。

  * **第一行: 概览信息**

      * `服务器信息` (占4列)
      * `服务器配置` (占4列)
      * `核心服务` (占4列)

  * **第二行: 核心配置**

      * `证书切换` (占4列)
      * `网络身份配置` (占8列)
          * 内部包含三个横向等分的子区块：`VPS出站IP` / `代理出站IP` / `分流出站`

  * **第三行: 协议详情**

      * `协议配置` (占12列，整行)

  * **第四行: 常用功能 (维持现状)**

      * `订阅链接` (占12列)
      * `流量统计` (占12列)

## 3\. 卡片内容与交互规范

### 3.1 服务器信息 (Card)

  * **用户备注名**: 纯文本。
  * **云厂商/区域**: 格式为 `<提供商> | <Region>` (例: `GCP | us-central1`)。
  * **Instance ID**: 纯文本。
  * **主机名 (Hostname)**: 纯文本。

### 3.2 服务器配置 (Card)

  * **CPU**: 进度条组件。显示 `已用 <pct>%`，后缀附加灰色小字说明，格式为 `<物理核心>C / <线程>T`。
  * **内存**: 进度条组件。显示 `已用 <pct>%`，后缀附加灰色小字说明，格式为 `<总内存>GiB + <虚拟内存>GiB`。
  * **磁盘**: 进度条组件。显示 `已用 <pct>%`，后缀附加灰色小字说明，格式为 `<总量>GiB`。
  * *注: 百分比取整数。*

### 3.3 核心服务 (Card)

  * **服务列表**:
      * Nginx: 显示状态 `运行中 / 已停止 / 异常 / 未安装`，并附带版本号。
      * Xray: 同上。
      * Sing-box: 同上。
  * **交互**: (可选) 点击“详情”可展开一个模态框或下拉区域，显示由后端提供的最近50行服务日志。

### 3.4 证书切换 (Card)

  * **证书类型**: `Let's Encrypt` / `自签名`。
  * **绑定域名**: 显示域名字符串，如 `example.com`；若无则显示 `(无)`。
  * **续期方式**: `自动` / `手动` (自签名证书默认为 `手动`)。
  * **到期日期**: 格式为 `YYYY-MM-DD`；自签名证书显示 `—`。

### 3.5 网络身份配置 (Composite Card)

这是一个组合卡片，内部包含三个逻辑区块。

#### a) VPS出站IP (Sub-section)

  * **公网身份**: `直连`
  * **VPS出站IP**: 显示IP地址，并附带一键复制按钮。
  * **ASN/ISP**: 字符串 (例: `AS15169 / Google`)。
  * **Geo**: 格式为 `国家代码-城市` (例: `US-Los Angeles`)。
  * **带宽限制**: 格式为 `上行 <Mbps> / 下行 <Mbps>` (未知则显示 `— / —`)。

#### b) 代理出站IP (Sub-section)

  * **代理身份**: `全代理`
  * **数据内容**: `代理出站IP`, `ASN/ISP`, `Geo`, `带宽限制` 字段同上，但数据来源于当前所用上游代理的出口标识，由后端探活并上报。

#### c) 分流出站 (Sub-section)

  * **混合身份**: `白名单VPS直连 + 其它代理`
  * **白名单**: 列表显示域名或网段。默认显示前3条，超出部分折叠，提供“查看全部”的交互。
  * **备注**: 卡片底部需包含注释：`注：HY2/TUIC 为 UDP 通道，VPS 直连，不走代理分流`。

### 3.6 协议配置 (Card)

  * **内容**: 沿用现有版本的大表格设计，包含`客户端配置`、`伪装效果`、`适用场景`、`运行状态`等列。
  * **去重**: 此卡片专注于协议本身，不再重复显示当前的出站分流状态。

### 3.7 订阅链接 & 流量统计 (Cards)

  * **布局**: 维持现有实现，仅需确保在新的12栅格体系下宽度和对齐正常。
  * **内容**: 功能和数据来源保持不变。

## 4\. 状态与空态规范

  * **加载中**: 所有卡片或卡片内的数据区域应显示骨架屏（Skeleton Screen）或灰色加载条。
  * **加载失败**: 在对应卡片的右上角显示一个红点角标。鼠标悬浮或点击后，显示具体的错误描述。
  * **字段未知/空值**:
      * 某个数据字段后端未返回或无法获取，显示 `—`。
      * 某个配置项未设置（如绑定域名），显示 `未配置`或`无`。

## 5\. 后端 API 接口字段 (Data Contract)

前端开发应严格依据以下 JSON 结构进行数据绑定。这是后端 `dashboard-backend.sh` 脚本输出的 `dashboard.json` 文件的约定格式。

```json
{
  "serverInfo": {
    "userNote": "edge-sfo-01",
    "cloud": {
      "provider": "GCP",
      "region": "us-central1"
    },
    "instanceId": "i-2f3a...9b",
    "hostname": "edgebox-01",
    "system": {
      "distro": "Debian 12",
      "kernel": "6.1.0",
      "uptime": "12d 04:32"
    }
  },
  "serverMetrics": {
    "cpu": {
      "usedPct": 37,
      "cores": 4,
      "threads": 8
    },
    "memory": {
      "usedPct": 62,
      "totalGiB": 8,
      "swapGiB": 2
    },
    "disk": {
      "usedPct": 41,
      "totalGiB": 80
    }
  },
  "coreServices": [
    {
      "name": "nginx",
      "status": "running",
      "version": "1.24.0"
    },
    {
      "name": "xray",
      "status": "running",
      "version": "1.8.15"
    },
    {
      "name": "sing-box",
      "status": "stopped",
      "version": "1.9.6"
    }
  ],
  "certificate": {
    "type": "lets-encrypt",
    "domain": "xxx.example.com",
    "renewal": "auto",
    "expireDate": "2025-12-01"
  },
  "networkIdentity": {
    "vps": {
      "mode": "direct",
      "egressIp": "35.212.192.41",
      "asn": "AS15169",
      "isp": "Google",
      "geo": {
        "country": "US",
        "city": "Los Angeles"
      },
      "bandwidth": {
        "upMbps": 1000,
        "downMbps": 1000
      }
    },
    "proxy": {
      "mode": "full-proxy",
      "egressIp": "91.203.36.10",
      "asn": "AS9009",
      "isp": "M247",
      "geo": {
        "country": "NL",
        "city": "Amsterdam"
      },
      "bandwidth": {
        "upMbps": 200,
        "downMbps": 200
      }
    },
    "shunt": {
      "mode": "mixed",
      "whitelist": [
        "googlevideo.com",
        "ytimg.com",
        "gvt2.com"
      ],
      "note": "HY2/TUIC 为 UDP 通道，VPS 直连"
    }
  }
}
```

## 6\. V2 改动摘要 (供前端对照)

  * **[替换]** 移除旧的顶部“基本信息”卡片，替换为新的三张独立卡片：`服务器信息` / `服务器配置` / `核心服务`。
  * **[独立]** “证书信息”从原先的混合卡片中独立出来，成为新的`证书切换`卡片。
  * **[删除]** 移除旧的“出站分流状态”卡片。
  * **[新增]** 新增`网络身份配置`组合卡片，它整合并扩展了原先“出站分流”卡片的功能。
  * **[扩充]** `协议配置`卡片从半行宽度扩大为整行（12列）。
  * **[维持]** `订阅链接`和`流量统计`卡片的功能和数据源保持不变，仅需在新的栅格布局下调整宽度和样式。
