
# 命令行工具参考 (`edgeboxctl`)

`edgeboxctl` 是 EdgeBox 的核心管理工具，它提供了一套丰富、强大且易于使用的命令，帮助您全面管理和维护节点。本文档是您使用 `edgeboxctl` 的完整参考指南。

## 核心设计

`edgeboxctl` 的所有命令都遵循一致的设计哲学：**原子化、幂等且有明确输出**。无论您执行什么操作，工具都会提供清晰的状态反馈，确保您对节点的每一次调整都尽在掌握。

---

## 命令大全

为了方便查阅，所有命令已按功能模块进行分类。

### **🎯 核心命令**

这些是日常管理中使用频率最高的命令。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl status` | **（最常用）** 全面健康检查，显示所有核心服务（Nginx, Xray, Sing-box）的运行状态、公网及内部端口的监听情况、当前证书模式以及出站分流状态。 |
| `edgeboxctl sub` | 显示当前模式下的订阅链接（同时提供普通 URL 和 Base64 格式），并展示面板的访问地址。 |
| `edgeboxctl restart` | 安全地重启所有核心服务。此命令有保护机制，会在重启前检查配置文件语法，防止因配置错误导致服务启动失败。推荐在修改配置后执行此命令。 |
| `edgeboxctl logs <service>` | 查看指定服务的实时日志，支持的服务包括 `nginx`、`xray` 和 `sing-box`。按 `Ctrl+C` 退出日志追踪。 |
| `edgeboxctl update` | 在线更新 EdgeBox 至最新版本。 |
| `edgeboxctl help` | 显示完整的帮助信息和所有可用命令。 |

### **🔒 证书与模式管理**

管理节点的 TLS 证书，并在 IP 模式与域名模式间无缝切换。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl switch-to-domain <域名>` | **（重要）** 将节点切换到域名模式。脚本会自动为您申请 Let's Encrypt 证书，并更新所有服务的配置以使用该证书。此操作会自动处理 `trojan.<域名>` 的证书申请逻辑。 |
| `edgeboxctl switch-to-ip` | 将节点切换回 IP 模式。所有服务将恢复使用自签名证书，客户端连接时需要允许“不安全连接”。 |
| `edgeboxctl cert status` | 检查当前证书的详细信息，包括类型（自签名或 Let's Encrypt）、绑定的域名、有效期以及剩余天数。 |
| `edgeboxctl cert renew` | 手动续期您的 Let's Encrypt 证书。通常无需手动执行，系统已配置定时任务自动续期。 |
| `edgeboxctl fix-permissions` | 修复证书文件的读写权限。当您手动替换证书或遇到权限问题时，此命令非常有用。 |

### **🌐 高级安全特性**

增强节点的安全性和抗检测能力。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl sni auto` | **（推荐）** 自动从内置的域名池中测试并智能选择一个最优的 SNI 伪装域名，用于 Reality 协议。 |
| `edgeboxctl sni set <域名>` | 手动强制指定一个 SNI 伪装域名，例如 `edgeboxctl sni set www.apple.com`。 |
| `edgeboxctl sni list` | 显示当前 SNI 域名池中的所有可用域名及其状态。 |
| `edgeboxctl rotate-reality [--force]` | 手动执行 Reality 密钥对的轮换。出于安全考虑，建议定期执行。增加 `--force` 参数可以忽略冷却时间强制执行。 |
| `edgeboxctl reality-status` | 查看 Reality 密钥的轮换周期状态。 |
| `edgeboxctl rotate-sid` | 无缝轮换 Reality 的 `shortId`，提供24小时的宽限期，用户在此期间更新订阅即可平滑过渡。 |
| `edgeboxctl traffic randomize [level]` | 执行流量特征随机化，通过调整协议参数（如心跳间隔、伪装站点等）来增强隐蔽性。支持 `light`, `medium`, `heavy` 三个级别。 |

### **👥 出站路由与分流**

精细化控制服务器的出站流量走向，是本项目的核心高级功能。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl shunt vps` | **（默认模式）** 设置为 VPS 直连出站。所有从 Xray 发起的流量都将使用服务器自身的 IP。 |
| `edgeboxctl shunt resi '<URL>'` | 设置为代理全量出站。所有从 Xray 发起的流量都将通过您指定的上游代理服务器转发。**URL 必须用单引号包裹**。 |
| `edgeboxctl shunt direct-resi '<URL>'` | **（推荐分流模式）** 设置为智能分流。匹配白名单的域名走 VPS 直连，其余流量走代理。**URL 必须用单引号包裹**。 |
| `edgeboxctl shunt status` | 查看当前的出站模式、代理健康状态以及出口 IP 地址等信息。 |
| `edgeboxctl shunt whitelist <action> [domain]` | 管理智能分流的白名单。支持的操作包括 `add`（添加）、`remove`（移除）、`list`（列出所有）和 `reset`（恢复默认）。 |

**代理 URL 格式支持:**
* `http://user:pass@<IP或域名>:<端口>`
* `https://user:pass@<IP或域名>:<端口>?sni=<SNI>`
* `socks5://user:pass@<IP或域名>:<端口>`

### **📊 流量与预警**

监控流量使用情况并设置强大的通知系统。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl traffic show` | 在终端中以文本形式查看今日和本月的流量使用统计。 |
| `edgeboxctl alert show` | 查看当前所有的预警配置，包括预算、阈值和通知渠道。 |
| `edgeboxctl alert monthly <GiB>` | 设置月度流量总预算，单位为 GiB。 |
| `edgeboxctl alert steps <p1,p2,...>` | 设置预警的百分比阈值，例如 `50,80,95`。 |
| `edgeboxctl alert telegram <token> <chat_id>` | 配置 Telegram 机器人作为通知渠道。 |
| `edgeboxctl alert discord <webhook_url>` | 配置 Discord Webhook 作为通知渠道。 |
| `edgeboxctl alert wechat <pushplus_token>` | 配置微信（通过 PushPlus）作为通知渠道。 |
| `edgeboxctl alert test [percent]` | 发送一条测试通知，以验证您的渠道配置是否正确。可以指定一个百分比，如 `80`。 |

### **🔧 配置与维护**

进行系统级的配置管理和维护操作。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl dashboard passcode` | 重置 Web 控制面板的访问密码。 |
| `edgeboxctl config show` | 显示所有协议的核心配置信息，如 UUID、密码、Reality 公钥等，方便手动配置客户端。 |
| `edgeboxctl config regenerate-uuid` | **（高危操作）** 为所有协议重新生成 UUID 和密码。执行后，所有用户都需要更新订阅才能连接。 |
| `edgeboxctl backup create` | 手动创建一个当前系统配置的完整备份。 |
| `edgeboxctl backup list` | 列出所有已创建的备份文件。 |
| `edgeboxctl backup restore <文件名>` | 从指定的备份文件恢复系统配置。 |
| `edgeboxctl alias "<备注>"` | 为当前服务器设置一个易于识别的别名，会显示在面板上。 |

### **🔍 诊断与排障**

当遇到连接问题时，这些命令可以帮助您快速定位故障。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl test` | 对核心端口（如 443）、订阅地址和控制面板进行基础连通性测试。 |
| `edgeboxctl debug-ports` | 检查所有 EdgeBox 使用的公网和内部端口的监听状态，快速排查端口占用或服务未启动问题。 |

---
