
# **最佳实践与应用场景**

欢迎阅读 EdgeBox 最佳实践指南！本文档将向您展示如何组合使用 EdgeBox 的各项强大功能，以满足不同的应用场景，从追求极致安全到实现成本效益最大化。

---

## **场景一：构建极致安全与隐私的“隐形”节点**

**目标**：在网络审查严格的环境中，最大限度地提升连接的隐蔽性和抗检测能力，构建一个难以被识别和封锁的“隐形”节点。

**核心策略**：VLESS-Reality 协议 + 动态安全增强三件套。

### **步骤 1：确认使用 VLESS-Reality 协议**

VLESS-Reality 是当前抗审查能力最强的协议之一，它通过“借用”真实知名网站的 TLS 指纹来伪装流量，使其在特征上与普通 HTTPS 访问几乎无法区分。在您的客户端中，请优先选择 `EdgeBox-REALITY` 节点。

### **步骤 2：启用全套动态安全增强**

静态的伪装长期来看仍有被特征分析的风险。EdgeBox 的动态安全系统旨在通过“持续变化”来对抗指纹识别，让您的流量成为一个移动的目标。

* **启用 SNI 域名池智能管理**
    系统已默认配置了每周一次的定时任务，自动从微软、苹果等知名网站中选择当前访问质量最好的域名作为您的伪装目标。您也可以随时手动触发一次智能选择：
    ```bash
    edgeboxctl sni auto
    ```

* **启用 Reality 密钥自动轮换**
    系统默认配置了每60天自动更换一次 Reality 密钥对，就像定期更换门锁。您也可以随时手动强制执行一次轮换，以应对突发风险：
    ```bash
    edgeboxctl rotate-reality --force
    ```

* **启用流量特征随机化**
    系统已配置了不同周期的定时任务，会自动微调 Hysteria2 和 TUIC 等协议的底层参数（如伪装站点），使流量的“行为”看起来更随机、更像普通用户的网络活动。

**结论**：通过组合 Reality 协议和动态安全三件套，您的节点将具备顶级的隐蔽性，能够从容应对大多数复杂的网络环境。

---

## **场景二：成本效益最大化（流媒体与敏感业务优化）**

**目标**：您拥有一个高质量的住宅 IP 代理，希望在观看大流量视频（如 Netflix, YouTube）时使用服务器的廉价流量，而在进行登录、支付等敏感操作时使用住宅 IP 以维持“干净”的账号画像，从而最大限度地节省代理流量费用。

**核心策略**：`direct-resi` 智能分流模式。

### **步骤 1：切换到智能分流模式**

执行以下命令，将 `<您的代理URL>` 替换为您的住宅 IP 代理地址（**必须用单引号包裹**）。
```bash
edgeboxctl shunt direct-resi '<您的代理URL>'
````

此模式下，**白名单内的域名走 VPS 直连**，其余所有**未在白名单的流量走代理**。

### **步骤 2：科学配置白名单**

白名单的原则是：**只将承载大流量且与账号身份弱关联的 CDN 域名加入白名单**。EdgeBox 已内置一套针对美区主流流媒体优化的默认白名单，您可以通过以下命令一键恢复：

```bash
edgeboxctl shunt whitelist reset
```

如果您有其他大流量应用，可以使用以下命令将其 CDN 域名添加进去：

```bash
edgeboxctl shunt whitelist add <域名1> <域名2>
```

### **步骤 3（关键）：重新应用分流配置**

在您**修改（添加、删除、重置）了白名单之后**，新的规则**不会**自动生效。您必须**重新执行一次 `direct-resi` 命令**来让 Xray 加载新的规则集。

```bash
edgeboxctl shunt direct-resi '<您的代理URL>'
```

**结论**：`direct-resi` 模式是兼顾成本与账号画像的最佳模式。通过科学维护白名单，您可以将 80% 以上的大流量业务（视频、下载）通过 VPS 直连完成，而仅将关键的、小流量的敏感业务通过昂贵的住宅代 理，实现成本效益最大化。

-----

## **场景三：为家庭或团队成员安全共享节点**

**目标**：您希望与家人或团队成员共享节点，但不想泄露拥有最高权限的主订阅链接，并希望能够管理每个人的使用情况。

**核心策略**：独立用户订阅系统。

### **步骤 1：为新用户签发专属订阅**

为每个用户创建一个独一无二的订阅链接，并可以限制其同时在线的设备数量。

```bash
# 为用户 "alice" 创建一个最多支持 5 台设备的订阅
edgeboxctl sub issue alice 5
```

执行后，将屏幕上显示的 `alice` 的专属 URL 发送给她即可。

### **步骤 2：监控使用情况**

您可以随时查看所有已签发用户的使用情况，包括他们当前绑定的设备详情和最后使用时间。

```bash
edgeboxctl sub show
```

### **步骤 3：管理用户权限**

  * **调整设备上限**：如果 `alice` 需要在更多设备上使用，可以随时调整她的配额。
    ```bash
    edgeboxctl sub limit alice 8
    ```
  * **吊销访问权限**：如果需要终止 `alice` 的访问权限，可以随时吊销。系统会自动执行“无缝凭据轮换”，被吊销的用户会在宽限期后失效，而**不影响**其他正常用户。
    ```bash
    edgeboxctl sub revoke alice
    ```

**结论**：独立用户订阅系统将管理员权限与普通用户权限完全隔离，提供了安全、可控、灵活的方式来共享您的 EdgeBox 节点。

````

---

### **2. 优化文档：`docs/用户指南 (User Guide)/06-特定环境配置策略.md`**

这份文档是将您 `README.md` 中关于云厂商的部分提炼、扩充和结构化后形成的全新指南。

```markdown
# **特定环境配置策略**

尽管 EdgeBox 的一键安装脚本设计为在大多数主流 Linux 环境中通用，但在特定的云服务商（如 GCP, AWS）平台上，通过一些针对性的配置，可以进一步优化性能、有效控制成本，并避免一些常见的“陷阱”。

本指南旨在为您提供在不同云平台上部署和运维 EdgeBox 的最佳实践。

---

## **1. GCP (Google Cloud Platform) 环境**

GCP 以其优质的网络著称，但也因其出站流量费用较高而需要特别注意。

* **核心策略**：**严防流量回源，避免不必要的出站成本。**

* **Cloudflare DNS 配置**
    如果您使用 Cloudflare 解析域名，务必将指向您服务器 IP 的 A/AAAA 记录的“代理状态”设置为 **DNS Only (仅DNS，灰云)**，而不是 Proxied (已代理，橙云)。否则，所有流量都会先经过 Cloudflare 再到达您的服务器，这会导致延迟增加，并可能隐藏客户端的真实 IP。
    * **自检方法**：
        ```bash
        # 应该返回您的服务器真实 IP
        dig A yourdomain.com +short
        
        # 返回的 HTTP 头中不应出现 server: cloudflare 或 cf-ray
        curl -I [https://yourdomain.com](https://yourdomain.com)
        ```

* **严禁开启 Cloudflare 流量服务**
    **切勿**在 Cloudflare 上为您的域名开启 Argo、WARP 或 Zero Trust 等任何流量代理服务。这些服务会将您服务器的**出站流量**也牵引至 Cloudflare 的网络，这在 GCP 上会被计算为高额的出站流量费用。

* **预算与告警设置**
    强烈建议在 GCP 控制台的 **“结算 (Billing) -> 预算和提醒 (Budgets & alerts)”** 中为您项目设置一个月度预算告警。同时，可以在 **“监控 (Monitoring) -> 提醒 (Alerting)”** 中，利用 `network/sent_bytes_count` 指标创建滚动时间窗口的阈值告警（例如，24小时内流量超过 10 GiB），以及时发现异常流量。

---

## **2. AWS (Amazon Web Services) 环境**

* **核心策略**：**充分利用每月免费的出站流量额度。**

* **善用智能分流**
    AWS 的 EC2 实例通常每月提供一定额度的免费出站流量（例如 100GB）。您可以通过 `direct-resi` 智能分流模式，将大流量的视频、下载等业务放在白名单内，使其通过 VPS 直连消耗免费额度。而将需要维持账号画像的小流量业务（如登录、支付）通过代理出口。

* **设置预算告警**
    请务必在 AWS 管理控制台开启 **AWS Budgets** 服务，设置一个略低于您预期的成本阈值，以便在免费额度即将用尽或产生预期外费用时，第一时间收到邮件通知。

---

## **3. 其他 VPS/VM 通用策略**

对于其他有明确流量限制的云服务商（如阿里云、Vultr、Bandwagon 等）。

* **核心策略**：**精细化监控，避免流量超额。**

* **定期检查用量**
    养成定期使用 `edgeboxctl traffic show` 命令或访问 Web 控制面板查看流量统计的习惯，并与您服务商后台的用量数据进行交叉比对。

* **使用流量预警功能**
    这是 EdgeBox 为您提供的最强大的成本控制工具。请务必根据您套餐的流量上限，配置好月度预算和通知渠道。
    ```bash
    # 示例：如果您的套餐每月提供 1TB (约 1000 GiB) 流量
    edgeboxctl alert monthly 1000
    
    # 在用量达到 50%、80%、95% 时收到通知
    edgeboxctl alert steps 50,80,95
    
    # 配置您的 Telegram 机器人
    edgeboxctl alert telegram <您的Token> <您的Chat ID>
    ```

* **警惕“隐式代理”**
    部分服务商可能会提供一些“智能加速”、“网络优化”等增值服务。请谨慎开启，并确认其工作原理，避免它们在您不知情的情况下将服务器流量重定向，从而产生额外费用或导致 IP画像混乱。

---

## **4. 快速自检清单**

在配置完成后，您可以通过以下命令快速验证各项策略是否按预期工作。

* **验证出站 IP**：
    ```bash
    # 在 vps 模式下，应返回您的服务器公网 IP
    # 在 resi 模式下，或在 direct-resi 模式下访问非白名单网站时，应返回代理的出口 IP
    curl -s [https://ipinfo.io/ip](https://ipinfo.io/ip)
    ```

* **验证 `nftables` 计数器** (用于智能分流流量统计)：
    ```bash
    # 检查 resi_addr set 是否已被正确写入代理IP地址
    nft list sets inet edgebox
    ```

* **验证分流效果**：
    * 在 `direct-resi` 模式下，访问一个白名单内的网站（如 YouTube），然后查看控制面板的流量图表。一段时间后，您应该能观察到 **VPS 出口（蓝色）** 的流量有明显增长，而 **代理出口（绿色）** 流量增长平缓。
````
