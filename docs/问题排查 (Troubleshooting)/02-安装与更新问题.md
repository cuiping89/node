# **问题排查：安装与更新**

本指南专注于解决在首次安装或后续更新 EdgeBox 过程中可能遇到的问题。

### **1. 安装前：`curl: command not found` 错误**

  * **问题现象**：执行一键安装命令时，终端提示 `bash: curl: command not found`。
  * **原因分析**：您使用的是一个“最小化”安装的操作系统（常见于 Debian），系统默认没有安装 `curl` 工具。
  * **解决方案**：手动安装 `curl` 即可。
    ```bash
    # 对于 Debian / Ubuntu 系统
    apt-get update
    apt-get install -y curl

    # 对于 CentOS / RHEL 系统
    yum install -y curl
    ```
    安装完成后，再重新执行一键安装命令。

### **2. 安装中：脚本因网络问题中断**

  * **问题现象**：安装脚本在下载文件（如 Xray, sing-box）时卡住或报错，提示 `Connection timed out` 或 `Could not resolve host`。
  * **原因分析**：您的服务器访问 GitHub 等资源的网络不佳。
  * **解决方案**：通过设置环境变量，为安装脚本指定一个下载代理。
    ```bash
    # 设置下载代理，然后执行安装命令
    export EDGEBOX_DOWNLOAD_PROXY="https://ghproxy.com/"
    bash <(curl -fsSL https://raw.githubusercontent.com/cuiping89/node/main/ENV/install.sh)
    ```
    > 您可以将 `https://ghproxy.com/` 替换为您信任的任何其他 GitHub 加速代理。

### **3. 安装后：核心服务启动失败**

  * **问题现象**：安装过程顺利结束，但 `edgeboxctl status` 显示 `nginx`, `xray` 或 `sing-box` 中有服务是 `inactive (dead)` 或 `failed` 状态。
  * **原因分析**：
    1.  **端口冲突**：服务器上已有其他程序占用了 `80`, `443` 等关键端口。
    2.  **系统兼容性问题**：极少数情况下，系统环境与服务不兼容。
  * **解决方案**：
    1.  **定位问题服务**：首先确定是哪个服务启动失败。
    2.  **查看错误日志**：使用 `edgeboxctl logs <失败的服务名>` 查看具体的错误信息。
          * 如果日志中包含 `address already in use` 或 `bind() failed`，说明是端口冲突。请使用 `ss -tlnp | grep <端口号>` 命令找出占用端口的程序并停止它，然后运行 `edgeboxctl restart`。
          * 如果是其他错误，请根据日志内容进行排查。

### **4. 更新后：出现异常**

  * **问题现象**：执行 `edgeboxctl update` 更新后，出现服务无法启动或配置不生效等问题。
  * **原因分析**：新旧版本的配置文件可能存在不兼容之处。
  * **解决方案**：
    1.  **检查日志**：首先按照上述“服务启动失败”的流程检查日志。
    2.  **使用备份恢复**：EdgeBox 在更新前会自动创建备份。您可以使用 `edgeboxctl backup list` 查看备份列表，并使用 `edgeboxctl backup restore <文件名>` 恢复到更新前的状态。
    3.  **联系支持**：如果无法自行解决，请携带相关日志向项目开发者报告问题。

-----
