
# **IP 质量检测评分系统 (IPq) 指南**

EdgeBox 内置了一个强大而智能的 IP 质量检测与评分系统（IP Quality, 简称 IPq），旨在帮助您清晰地了解服务器出口 IP 的“纯净度”和“画像”，从而做出更优的出站分流决策。

## **1. 什么是 IPq 系统？**

IPq 系统是一个自动化的诊断工具，它会对您的**服务器本机 IP (VPS)** 以及您在分流模式下配置的**上游代理 IP** 进行多维度的综合评估，并给出一个量化的分数和等级。

您可以在控制面板的 **[网络身份配置]** 卡片中看到评分的摘要，并点击 **[查看详情]** 获取完整的分析报告。

## **2. 为什么 IPq 很重要？**

一个 IP 地址的“质量”直接影响您在互联网上的行为体验和账号安全。

  * **账号画像纯净度**：许多网站（特别是流媒体、社交和电商平台）会检测访问 IP 的类型。使用数据中心（Datacenter/IDC）IP 进行注册或登录，被风控的概率远高于使用住宅（Residential）或移动（Mobile）IP。
  * **解锁能力**：一个“干净”的、归属于目标区域的住宅 IP，通常能解锁更多的流媒体服务。
  * **性能评估**：除了画像，IP 的延迟和带宽也直接决定了您的网络体验。

IPq 系统通过量化这些指标，为您在选择 `vps`、`resi` 还是 `direct-resi` 模式时，提供了关键的数据支持。

## **3. IPq 系统是如何工作的？**

`edgebox-ipq.sh` 脚本每日定时执行（默认凌晨 2:15），或在您切换出站模式后触发。它会模拟真实的客户端，从多个维度对 IP 进行探测和评估。

### **核心检测维度**

| 检测项 | 数据来源 | 说明 |
| :--- | :--- | :--- |
| **基础信息** | `ipinfo.io`, `ip.sb`, `ip-api.com` 等 | 通过多个 API 交叉验证，获取 IP、地理位置（国家/城市）、ASN、ISP（运营商）和 rDNS（反向域名解析）等基础信息。 |
| **网络类型识别** | ASN 和 ISP 关键字匹配 | 智能分析 ASN 和 ISP 的名称，判断 IP 属于**数据中心 (Datacenter)**、**云平台 (Cloud)**、**住宅 (Residential)还是移动 (Mobile)** 网络。 |
| **DNS 黑名单 (DNSBL)** | `spamhaus.org`, `spamcop.net` 等 | 查询多个权威的 DNS 黑名单数据库，检查该 IP 是否因发送垃圾邮件或其他滥用行为而被标记。 |
| **延迟 (Latency)** | `ping` (VPS) / `curl` (Proxy) | 测试到 Cloudflare 的网络延迟，反映了 IP 的响应速度。 |
| **带宽 (Bandwidth)** | `curl` 速度测试 | 测试到 Speedtest 节点的上下行带宽，评估 IP 的网络吞吐能力。 |

### **评分与等级模型**

系统采用100分制进行评分，并根据分数划定A/B/C/D四个等级。

  * **基础分**: 100分
  * **加分项**:
      * `+10` 分：如果网络类型被识别为 **住宅 (Residential)** 网络。
  * **减分项**:
      * `-25` 分：如果 IP 被检测出具有代理标记。
      * `-5` 至 `-8` 分：如果 IP 属于云平台或数据中心。
      * `-12` 分/个：每命中一个 DNSBL 黑名单。
      * `-8` 至 `-15` 分：根据延迟高低进行扣分。

**等级划分:**

| 分数范围 | 等级 | 含义 |
| :--- | :--- | :--- |
| ≥ 80 | **A** | **优秀**: 通常是干净的住宅或高质量 IP。 |
| 60 - 79 | **B** | **良好**: 可能是普通的数据中心 IP 或有少量负面记录。 |
| 40 - 59 | **C** | **一般**: 存在较为明显的负面特征，如命中黑名单或高延迟。 |
| \< 40 | **D** | **较差**: 不推荐用于对 IP 质量要求高的场景。 |

## **4. 如何使用与解读？**

### **查看评分**

1.  访问您的 EdgeBox 控制面板。
2.  定位到 **[网络身份配置]** 卡片。
3.  在 “VPS出站IP” 和 “代理出站IP” 子模块中，您可以看到各自的 **IP质量** 分数和等级摘要。

### **查看详细报告**

点击分数旁边的 **[查看详情]** 按钮，会弹出一个包含完整诊断信息的报告，内容如下：

  * **总览**: 最终分数、等级和检测时间。
  * **身份信息**: IP 地址、ASN/ISP、地理位置、rDNS。
  * **质量细项**: 网络类型（如 `Datacenter` 或 `Residential`）、延迟中位数。
  * **风险与黑名单**: 代理/机房等特征标记、命中的黑名单列表。
  * **结论**: 一段基于所有数据的自然语言总结。

### **决策建议**

  * 当您看到代理 IP 的等级为 **A** 且网络类型为 **Residential** 时，它非常适合用于 `resi` 或 `direct-resi` 模式来“养护”您的账号。
  * 如果 VPS 本机的 IP 等级就是 **A** 或 **B**，那么在 `direct-resi` 模式下，将大部分 CDN 域名加入白名单直连，是一个性价比极高的选择。
  * 如果任一 IP 的等级为 **D**，或在详细报告中看到它命中了多个黑名单，您应谨慎使用该 IP 访问敏感网站。

## **5. 手动触发检测**

除了定时任务，您也可以随时通过 SSH 登录服务器，手动执行以下命令来立即刷新 IPq 报告：

```bash
/usr/local/bin/edgebox-ipq.sh
```

执行后约10-20秒，刷新您的 Web 控制面板即可看到最新的评分结果。
