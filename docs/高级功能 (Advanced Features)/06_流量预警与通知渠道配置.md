# æµé‡é¢„è­¦ä¸é€šçŸ¥æ¸ é“é…ç½®

---

## ç›®å½•

* [æ¦‚è¿°](#æ¦‚è¿°)
* [å·¥ä½œåŸç†ä¸æ–‡ä»¶ä½ç½®](#å·¥ä½œåŸç†ä¸æ–‡ä»¶ä½ç½®)
* [å¿«é€Ÿå…¥é—¨ï¼ˆ3 æ­¥ï¼‰](#å¿«é€Ÿå…¥é—¨3-æ­¥)
* [å‘½ä»¤å‚è€ƒ](#å‘½ä»¤å‚è€ƒ)
* [æ¸ é“é…ç½®](#æ¸ é“é…ç½®)

  * [Telegram æœºå™¨äºº](#telegram-æœºå™¨äºº)
  * [Discord Webhook](#discord-webhook)
  * [å¾®ä¿¡ï¼ˆPushPlusï¼‰](#å¾®ä¿¡pushplus)
  * [é€šç”¨ Webhookï¼ˆraw|slack|discordï¼‰](#é€šç”¨-webhookrawslackdiscord)
  * [é‚®ä»¶ï¼ˆå¯é€‰ï¼‰](#é‚®ä»¶å¯é€‰)
* [å®‰å…¨ä¸æƒé™](#å®‰å…¨ä¸æƒé™)
* [éªŒè¯ä¸æ’é”™](#éªŒè¯ä¸æ’é”™)
* [é…ç½®æ–‡ä»¶è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰](#é…ç½®æ–‡ä»¶è¯´æ˜ç¤ºä¾‹)
* [é™„ï¼šä¸€é”®è‡ªæ£€è„šæœ¬](#é™„ä¸€é”®è‡ªæ£€è„šæœ¬)

---

## æ¦‚è¿°

EdgeBox æä¾›åŸºäº **æœˆåº¦æµé‡é¢„ç®—** çš„å‘Šè­¦èƒ½åŠ›ã€‚ç³»ç»ŸæŒ‰å°æ—¶æ±‡æ€»å½“æœˆå‡ºç«™ç”¨é‡ï¼Œå½“è¾¾åˆ°è®¾å®šé˜ˆå€¼ï¼ˆå¦‚ 50%/80%/95%ï¼‰æ—¶ï¼Œé€šè¿‡ä½ é…ç½®çš„ **é€šçŸ¥æ¸ é“**ï¼ˆTelegram / Discord / PushPlus / é€šç”¨ Webhook / é‚®ä»¶ï¼‰ä¸‹å‘æé†’ï¼Œé¿å…è¶…é‡æˆ–è¢«å°é¡¶ã€‚

> **å•ä½è¯´æ˜**ï¼šé‡‡é›†è„šæœ¬ä»¥å­—èŠ‚ï¼ˆBytesï¼‰è®°è´¦ï¼Œå‰ç«¯å±•ç¤ºæŒ‰ IECï¼ˆKiB/MiB/GiB/TiBï¼‰è‡ªé€‚åº”ï¼›CLI `edgeboxctl traffic show` ä¹ŸæŒ‰å­—èŠ‚æ¢ç®—ï¼Œä¸ä½ çš„å‰ç«¯å›¾è¡¨ä¿æŒåŒé‡çº§ã€‚

---

## å‘½ä»¤å‚è€ƒ

```text
edgeboxctl alert show                      # æŸ¥çœ‹å½“å‰å‘Šè­¦é…ç½®
edgeboxctl alert monthly <GiB>             # è®¾ç½®å½“æœˆé¢„ç®—ï¼ˆå•ä½ GiBï¼‰
edgeboxctl alert steps <p1,p2,...>         # è®¾ç½®åˆ†æ®µé˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼Œé€—å·åˆ†éš”ï¼‰

edgeboxctl alert telegram <token> <chat_id>        # é…ç½® Telegram æ¸ é“
edgeboxctl alert discord  <webhook_url>            # é…ç½® Discord æ¸ é“ï¼ˆä¸“ç”¨å­—æ®µï¼‰
edgeboxctl alert wechat   <pushplus_token>         # é…ç½® PushPlusï¼ˆå¾®ä¿¡ï¼‰
edgeboxctl alert webhook  <url> [raw|slack|discord]# é…ç½®é€šç”¨ Webhookï¼ˆå£°æ˜è½½è·æ ¼å¼ï¼‰

edgeboxctl alert test [percent]            # æ¨¡æ‹Ÿè§¦å‘å‘Šè­¦ï¼ˆé»˜è®¤ 80%ï¼‰
```
---

## å¿«é€Ÿå…¥é—¨ï¼ˆ3 æ­¥ï¼‰

1. **è®¾å®šé¢„ç®—ä¸é˜ˆå€¼**

```bash
edgeboxctl alert monthly 200        # è®¾ç½®æœ¬æœˆé¢„ç®— 200 GiB
edgeboxctl alert steps 50,80,95     # åœ¨ 50%ã€80%ã€95% æ—¶å„è§¦å‘ä¸€æ¬¡
```

2. **é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªé€šçŸ¥æ¸ é“**ï¼ˆè¯¦è§ä¸‹æ–‡â€œæ¸ é“é…ç½®â€ï¼‰
3. **æ¨¡æ‹Ÿè§¦å‘ï¼ŒéªŒè¯é“¾è·¯**

```bash
edgeboxctl alert test 80            # æ¨¡æ‹Ÿæœ¬æœˆå·²ç”¨ 80% è§¦å‘é¢„è­¦
edgeboxctl alert show               # æŸ¥çœ‹å½“å‰é…ç½®
sudo tail -n 20 /var/log/edgebox-traffic-alert.log
```

> è¯´æ˜ï¼š`alert test` ä¸ä¼šæ¶ˆè€—çœŸå®æµé‡ï¼›å®ƒä¼šä¸´æ—¶æ„é€ ä¸€ä¸ª 80% ç”¨é‡åœºæ™¯ï¼Œå¹¶é‡ç½® `alert.state` ä»¥ä¾¿è§‚å¯Ÿå‘Šè­¦æ˜¯å¦èƒ½è¢«è§¦å‘ã€‚

---

## Telegram æ¸ é“é…ç½®ï¼š

### **ç¬¬ 1 æ­¥ï¼šè·å–æœºå™¨äºº Token**

æˆ‘ä»¬éœ€è¦å…ˆåœ¨ Telegram ä¸Šåˆ›å»ºä¸€ä¸ªæœºå™¨äººâ€œå°åŠ©æ‰‹â€æ¥å¸®æˆ‘ä»¬å‘æ¶ˆæ¯ã€‚

1.  **æ‰¾åˆ°â€œæœºå™¨äººæ•™çˆ¶â€** ğŸ‘‘
    åœ¨ Telegram æœç´¢æ¡†ä¸­è¾“å…¥ **`@BotFather`**ï¼Œé€‰æ‹©é‚£ä¸ªæœ‰å®˜æ–¹è®¤è¯è“è‰²å¯¹å‹¾ âœ”ï¸ çš„è´¦å·ï¼Œç„¶åç‚¹å‡» **Start**ã€‚

2.  **åˆ›å»ºæ–°æœºå™¨äºº**
    åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥ `/newbot` å¹¶å‘é€ã€‚

3.  **ç»™æœºå™¨äººèµ·å**
    BotFather ä¼šé—®ä½ æœºå™¨äººçš„åå­—ï¼Œè¿™ä¸ªå¯ä»¥éšä¾¿å¡«ï¼Œæ¯”å¦‚ `æˆ‘çš„æœåŠ¡å™¨ç®¡å®¶`ã€‚

4.  **è®¾ç½®æœºå™¨äººç”¨æˆ·å**
    æ¥ä¸‹æ¥è®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·åï¼Œ**è§„åˆ™æ˜¯ï¼šå¿…é¡»ä»¥ `bot` ç»“å°¾**ã€‚ä¾‹å¦‚ `MyVPS_alert_bot`ã€‚å¦‚æœæç¤ºè¢«å ç”¨ï¼Œæ¢ä¸€ä¸ªå³å¯ã€‚

5.  **å¤åˆ¶ Tokenï¼** âœ…
    æˆåŠŸåï¼ŒBotFather ä¼šå‘ç»™ä½ ä¸€å¤§æ®µåŒ…å« `Use this token to access the HTTP API:` çš„æ¶ˆæ¯ã€‚é‚£ä¸²çº¢è‰²çš„ã€ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„é•¿å­—ç¬¦ä¸²å°±æ˜¯æ‚¨çš„ **Token**ã€‚

    > **è¯·å¤åˆ¶å¹¶ä¿å­˜å¥½è¿™ä¸² Tokenï¼Œå®ƒåƒå¯†ç ä¸€æ ·é‡è¦ã€‚**

6.  **(â€¼ï¸ å…³é”®ä¸€æ­¥) å¯åŠ¨ä½ çš„æœºå™¨äºº**
    ç‚¹å‡» BotFather æ¶ˆæ¯ä¸­ä½ åˆšåˆšåˆ›å»ºçš„æœºå™¨äººé“¾æ¥ï¼ˆä¾‹å¦‚ `@MyVPS_alert_bot`ï¼‰ï¼Œè¿›å…¥å’Œå®ƒçš„å¯¹è¯æ¡†ï¼Œç„¶å**åŠ¡å¿…ç‚¹å‡»åº•éƒ¨çš„ `Start` æŒ‰é’®**ã€‚

### **ç¬¬ 2 æ­¥ï¼šè·å–ä½ çš„ Chat ID**

`Chat ID` å°±æ˜¯å‘Šè¯‰æœºå™¨äººâ€œè¦æŠŠæ¶ˆæ¯å‘ç»™è°â€çš„åœ°å€ã€‚

1.  **æ‰¾åˆ°â€œIDæŸ¥è¯¢æœºå™¨äººâ€** ğŸ†”
    åœ¨ Telegram æœç´¢æ¡†ä¸­è¾“å…¥ **`@userinfobot`**ï¼Œé€‰æ‹©å®ƒå¹¶ç‚¹å‡» **Start**ã€‚

2.  **è·å–ä½ çš„ ID**
    å®ƒä¼šç«‹åˆ»å›å¤æ‚¨çš„ä¿¡æ¯ï¼Œå…¶ä¸­ `Id:` åé¢çš„é‚£ä¸€ä¸²**çº¯æ•°å­—**å°±æ˜¯æ‚¨çš„ **Chat ID**ã€‚

### **ç¬¬ 3 æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šé…ç½®å¹¶æµ‹è¯•**

ç°åœ¨ï¼Œæˆ‘ä»¬å›åˆ°æœåŠ¡å™¨çš„SSHç»ˆç«¯ï¼ŒæŠŠåˆšåˆšè·å¾—çš„ä¸¤ä¸ªâ€œå¯†ç â€å‘Šè¯‰ EdgeBoxã€‚

1.  **æ‰§è¡Œé…ç½®å‘½ä»¤**
    è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† `<æ‚¨çš„Token>` å’Œ `<æ‚¨çš„Chat ID>` æ›¿æ¢æˆæ‚¨åˆšåˆšè·å¾—çš„å†…å®¹ï¼š

    ```bash
    edgeboxctl alert telegram <æ‚¨çš„Token> <æ‚¨çš„Chat ID>
    ```

    **ä¾‹å¦‚ï¼š**

    ```bash
    edgeboxctl alert telegram 123456:ABC-DEF_your_token 987654321
    ```

2.  **å‘é€æµ‹è¯•æ¶ˆæ¯**
    æ‰§è¡Œæµ‹è¯•å‘½ä»¤ï¼š

    ```bash
    edgeboxctl alert test
    ```

3.  **æ£€æŸ¥ Telegramï¼** ğŸ‰
    å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨çš„ Telegram ä¼šç«‹åˆ»æ”¶åˆ°ä¸€æ¡æ¥è‡ªæ‚¨æœºå™¨äººçš„æµ‹è¯•æ¶ˆæ¯ï¼Œå°±åƒè¿™æ ·ï¼š

æ­å–œï¼æ‚¨çš„æµé‡é¢„è­¦é€šçŸ¥å·²ç»é…ç½®æˆåŠŸã€‚ç°åœ¨æœåŠ¡å™¨ä¼šåœ¨æµé‡è¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨é€šçŸ¥æ‚¨äº†ã€‚

### **æ”¶ä¸åˆ°æ¶ˆæ¯æ€ä¹ˆåŠï¼Ÿ**

å¦‚æœæ‰§è¡Œ `edgeboxctl alert test`åæ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š
1.  **æ‚¨å¯¹åˆ›å»ºçš„æœºå™¨äººè¯´è¿‡ `/start` å—ï¼Ÿ** è¿™æ˜¯æœ€å¸¸è§çš„é—®é¢˜ï¼Œè¯·è¿”å›ç¬¬1æ­¥çš„ç¬¬6å°æ­¥ç¡®è®¤ã€‚
2.  **Token å’Œ Chat ID å¤åˆ¶æ­£ç¡®äº†å—ï¼Ÿ** Tokenå¾ˆé•¿ï¼ŒChat IDå¯¹äºç¾¤ç»„æ˜¯è´Ÿæ•°ã€‚è¯·ä»”ç»†æ ¸å¯¹ã€‚
3.  **æœåŠ¡å™¨èƒ½è¿æ¥åˆ° Telegram å—ï¼Ÿ** åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ `curl https://api.telegram.org`ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡ååº”æˆ–æŠ¥é”™ï¼Œè¯´æ˜æ‚¨çš„æœåŠ¡å™¨ç½‘ç»œè®¿é—® Telegram å—é™ã€‚
   
---

### Discord Webhook

**ç”¨é€”**ï¼šæŠŠå‘Šè­¦æ¶ˆæ¯å‘åˆ°æŒ‡å®š Discord é¢‘é“ã€‚

**è·å– Webhook**ï¼šæœåŠ¡å™¨ â†’ é¢‘é“è®¾ç½® â†’ Integrations â†’ Webhooks â†’ New Webhook â†’ å¤åˆ¶ URLã€‚

**å†™å…¥é…ç½®**ï¼ˆäºŒé€‰ä¸€ï¼Œæ¨èéƒ½è®¾ï¼‰ï¼š

```bash
edgeboxctl alert discord https://discord.com/api/webhooks/xxxx/xxxx
# åŒæ—¶æŠŠé€šç”¨ Webhook æŒ‡å‘ Discordï¼Œå¹¶å£°æ˜æ ¼å¼ä¸º discord
edgeboxctl alert webhook https://discord.com/api/webhooks/xxxx/xxxx discord
```

> æˆåŠŸé€šå¸¸è¿”å› `204 No Content`ï¼›çœ‹ä¸åˆ°æ­£æ–‡æ˜¯æ­£å¸¸ç°è±¡ã€‚

---

### å¾®ä¿¡ï¼ˆPushPlusï¼‰

**ç”¨é€”**ï¼šé€šè¿‡ PushPlus è§¦è¾¾å¾®ä¿¡ã€‚

**å†™å…¥é…ç½®**ï¼š

```bash
edgeboxctl alert wechat <pushplus_token>
edgeboxctl alert show
edgeboxctl alert test 80
```

> æ³¨æ„ï¼šéœ€ä¿è¯æœåŠ¡å™¨å¯è®¿é—® PushPlus æ¥å£ï¼›å¦‚æŠ¥é™æµæˆ– token æ— æ•ˆï¼Œè¯·åœ¨ PushPlus åå°æ ¸å¯¹ã€‚

---

### é€šç”¨ Webhookï¼ˆraw|slack|discordï¼‰

**ç”¨é€”**ï¼šå¯¹æ¥ Slack / é£ä¹¦ / è‡ªå»ºæœºå™¨äººæˆ–ä»»æ„ HTTP æ¥æ”¶ç«¯ã€‚

**å†™å…¥é…ç½®**ï¼š

```bash
# rawï¼šå‘é€ {"text":"..."}ï¼Œå…¼å®¹å¤šæ•°ç®€å•æ¥æ”¶ç«¯ / Slack æ–‡æœ¬
edgeboxctl alert webhook https://example.com/hook raw

# slackï¼šSlack é£æ ¼ï¼ˆä¸ raw æ¥è¿‘ï¼Œç»†èŠ‚å¯èƒ½æœ‰æ‰©å±•ï¼‰
edgeboxctl alert webhook https://hooks.slack.com/services/... slack

# discordï¼šå‘é€ {"content":"..."}ï¼ŒåŒ¹é… Discord çš„æ¨èè½½è·
edgeboxctl alert webhook https://discord.com/api/webhooks/... discord
```

**å…¼å®¹æ€§æç¤º**ï¼š

* æ—§ç‰ˆ `traffic-alert.sh` ä»…æŒ‰ `raw` å‘é€ï¼ˆ`{"text":"..."}`ï¼‰ã€‚è‹¥ä½ å½“å‰ Webhook åªæ”¶ `content` å­—æ®µï¼Œè¯·ï¼š

  1. å‡çº§åˆ°æ”¯æŒ `ALERT_WEBHOOK_FORMAT` çš„è„šæœ¬ï¼›æˆ–
  2. ç›´æ¥é…ç½® `edgeboxctl alert discord <url>` ä½¿ç”¨ä¸“ç”¨å˜é‡ï¼›æˆ–
  3. è°ƒæ•´æ¥æ”¶ç«¯ä»¥å…¼å®¹ `text` å­—æ®µã€‚

---

### é‚®ä»¶ï¼ˆå¯é€‰ï¼‰

**å¯ç”¨**ï¼šç¼–è¾‘ `/etc/edgebox/traffic/alert.conf`ï¼Œå¡«å†™ç›®æ ‡é‚®ç®±ï¼š

```ini
ALERT_EMAIL=me@example.com
```

ç¡®ä¿ç³»ç»Ÿ `mail` å‘½ä»¤å¯ç”¨ï¼ˆå»ºè®®å®‰è£…å¹¶é…ç½® `msmtp` æˆ– `postfix`ï¼‰ã€‚

**æµ‹è¯•**ï¼š

```bash
edgeboxctl alert test 80
```

---

## å®‰å…¨ä¸æƒé™

```bash
sudo chown root:root /etc/edgebox/traffic/alert.conf
sudo chmod 600 /etc/edgebox/traffic/alert.conf
```

* é…ç½®æ–‡ä»¶åŒ…å«ä»¤ç‰Œ/å¯†é’¥ï¼Œä»…åœ¨å¯ä¿¡ä¸»æœºä¸Šæ‰§è¡Œ `edgeboxctl alert telegram|discord|wechat|webhook ...`ã€‚
* å¦‚éœ€ä»£ç†è®¿é—®ç¬¬ä¸‰æ–¹æ¥å£ï¼Œå¯åœ¨æœåŠ¡ç¯å¢ƒä¸º `curl` è®¾ç½® `https_proxy`/`http_proxy`ã€‚

---

## éªŒè¯ä¸æ’é”™

**æŸ¥çœ‹é…ç½®**

```bash
edgeboxctl alert show
```

**æŸ¥çœ‹å‘Šè­¦æ—¥å¿—**

```bash
sudo tail -n 50 /var/log/edgebox-traffic-alert.log
```

**æ‰‹å·¥æ‰§è¡Œå‘Šè­¦è„šæœ¬**

```bash
sudo bash -lc '/etc/edgebox/scripts/traffic-alert.sh'
```

**å¸¸è§é—®é¢˜**

* **æœªæ”¶åˆ°æ¶ˆæ¯**ï¼šæ£€æŸ¥ç½‘ç»œè¿é€šï¼ˆ`curl -v <webhook_url>`ï¼‰ã€ä»¤ç‰Œæœ‰æ•ˆæ€§ã€Webhook è½½è·æ ¼å¼æ˜¯å¦åŒ¹é…ã€‚
* **Telegram è·å–ä¸åˆ° chat_id**ï¼šå…ˆè®©æœºå™¨äººæ”¶åˆ°ä¸€æ¡æ¶ˆæ¯å† `getUpdates`ï¼›ç¾¤ç»„ ID é€šå¸¸æ˜¯è´Ÿå·å¼€å¤´ã€‚
* **é‡å¤è½°ç‚¸**ï¼š`alert.state` ä¼šè®°å½•å·²è§¦å‘è¿‡çš„ç™¾åˆ†æ¯”ã€‚`alert test` ä¸ºæµ‹è¯•ä¼šæ¸…ç©ºå®ƒï¼Œå±æ­£å¸¸è¡Œä¸ºã€‚
* **å¤§é™†ç½‘ç»œç¯å¢ƒ**ï¼šTelegram/éƒ¨åˆ† Webhook éœ€å‡ºç«™ä»£ç†ï¼›ç¡®ä¿è¿™ç±»åŸŸåèµ° VPS å‡ºç«™æˆ–ä¸º `curl` é…ç½®ä»£ç†ã€‚

---

## é…ç½®æ–‡ä»¶è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰

æ–‡ä»¶ï¼š`/etc/edgebox/traffic/alert.conf`

```ini
# é¢„ç®—ï¼ˆå•ä½ GiBï¼‰
ALERT_MONTHLY_GIB=200

# Telegram
ALERT_TG_BOT_TOKEN=
ALERT_TG_CHAT_ID=

# Discord ä¸“ç”¨ Webhook
ALERT_DISCORD_WEBHOOK=

# PushPlusï¼ˆå¾®ä¿¡ï¼‰
ALERT_PUSHPLUS_TOKEN=

# é€šç”¨ Webhook
ALERT_WEBHOOK=
ALERT_WEBHOOK_FORMAT=raw   # raw|slack|discordï¼ˆè€è„šæœ¬ä»… raw ç”Ÿæ•ˆï¼‰

# åˆ†æ®µé˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼Œé€—å·åˆ†éš”ï¼‰
ALERT_STEPS=30,60,90

# é‚®ä»¶ï¼ˆå¯é€‰ï¼‰
ALERT_EMAIL=
```

---

## é™„ï¼šä¸€é”®è‡ªæ£€è„šæœ¬

> ä½ç½®å»ºè®®ï¼š`/etc/edgebox/scripts/alert-selfcheck.sh`ï¼Œèµ‹äºˆå¯æ‰§è¡Œæƒé™ `chmod +x`ã€‚è¿è¡Œåè‡ªåŠ¨æ£€æµ‹ä¾èµ–ã€è¯»å–é…ç½®ã€è¿é€šå„å·²å¯ç”¨æ¸ é“å¹¶å‘é€ä¸€æ¡ã€Œè‡ªæ£€ã€æ¶ˆæ¯ã€‚

```bash
#!/usr/bin/env bash
set -euo pipefail
CONF="/etc/edgebox/traffic/alert.conf"
LOG="/var/log/edgebox-traffic-alert.log"
[[ -f "$CONF" ]] || { echo "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼š$CONF"; exit 1; }
command -v curl >/dev/null || { echo "ç¼ºå°‘ curl"; exit 1; }
command -v jq   >/dev/null || { echo "ç¼ºå°‘ jq"; exit 1; }

source "$CONF"
now() { date '+%F %T'; }
msg="[EdgeBox è‡ªæ£€] $(now) â€” è¿™æ˜¯ä¸€æ¬¡æ¸ é“è¿é€šæ€§æµ‹è¯•ï¼Œä¸ä»£è¡¨çœŸå®æµé‡å‘Šè­¦ã€‚"

ok(){ echo "[OK] $1"; }
ko(){ echo "[ERR] $1"; }

# Telegram
if [[ -n "${ALERT_TG_BOT_TOKEN:-}" && -n "${ALERT_TG_CHAT_ID:-}" ]]; then
  resp=$(curl -sS -X POST \
    "https://api.telegram.org/bot${ALERT_TG_BOT_TOKEN}/sendMessage" \
    -d chat_id="${ALERT_TG_CHAT_ID}" -d text="$msg") || { ko "Telegram è¿æ¥å¤±è´¥"; }
  [[ "$(jq -r '.ok // false' <<<"$resp")" == "true" ]] && ok "Telegram å·²é€è¾¾" || ko "Telegram è¿”å›å¼‚å¸¸ï¼š$resp"
fi

# Discord ä¸“ç”¨
if [[ -n "${ALERT_DISCORD_WEBHOOK:-}" ]]; then
  curl -sS -X POST -H 'Content-Type: application/json' \
    -d "{\"content\":\"$msg\"}" "$ALERT_DISCORD_WEBHOOK" >/dev/null \
    && ok "Discord å·²æäº¤" || ko "Discord æäº¤å¤±è´¥"
fi

# é€šç”¨ Webhook
if [[ -n "${ALERT_WEBHOOK:-}" ]]; then
  fmt="${ALERT_WEBHOOK_FORMAT:-raw}"
  case "$fmt" in
    discord) payload="{\"content\":\"$msg\"}";;
    *)       payload="{\"text\":\"$msg\"}";;
  esac
  curl -sS -X POST -H 'Content-Type: application/json' -d "$payload" "$ALERT_WEBHOOK" >/dev/null \
    && ok "é€šç”¨ Webhook($fmt) å·²æäº¤" || ko "é€šç”¨ Webhook æäº¤å¤±è´¥"
fi

# PushPlus
if [[ -n "${ALERT_PUSHPLUS_TOKEN:-}" ]]; then
  curl -sS -X POST -H 'Content-Type: application/json' \
    -d "{\"token\":\"$ALERT_PUSHPLUS_TOKEN\",\"title\":\"EdgeBox è‡ªæ£€\",\"content\":\"$msg\"}" \
    https://www.pushplus.plus/send >/dev/null \
    && ok "PushPlus å·²æäº¤" || ko "PushPlus æäº¤å¤±è´¥"
fi

echo "æ—¥å¿—ï¼š$LOG"
```

---

> **è½åœ°å»ºè®®**ï¼š
>
> * æ–‡æ¡£ä¿å­˜ä¸ºï¼š`docs/guide-alerts.md`ï¼›
> * è‡ªæ£€è„šæœ¬ï¼š`/etc/edgebox/scripts/alert-selfcheck.sh`ï¼›
> * åˆæ¬¡éƒ¨ç½²åï¼š`edgeboxctl alert show && sudo /etc/edgebox/scripts/alert-selfcheck.sh`ï¼Œç¡®è®¤æ‰€æœ‰æ¸ é“å‡è¿é€šã€‚
