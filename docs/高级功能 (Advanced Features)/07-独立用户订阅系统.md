
# **独立用户订阅系统**

EdgeBox 不仅为管理员提供了强大的主订阅功能，还内置了一套完整、安全的独立用户订阅系统。该系统允许您为家人、朋友或团队成员签发专属的、隔离的订阅链接，并对他们的使用进行精细化管理。

## **1. 这是什么功能？**

您可以将其理解为一个“访客管理系统”。管理员的主订阅链接拥有最高权限且包含了所有节点的配置信息，通常不适合直接分享。独立用户订阅系统解决了这个问题，您可以：

  * 为每个用户（如 `alice`, `bob`）生成**独一无二的订阅链接**。
  * 限制每个用户链接可以同时在线的**设备数量**。
  * 随时**吊销**某个用户的访问权限，而**不影响**其他用户和您自己的使用。
  * 查看每个用户绑定的设备信息和最后使用时间。

## **2. 它为什么重要？**

  * **安全性**：将管理员权限与普通用户权限完全隔离。分享专属链接远比分享您的主订阅安全。
  * **可管理性**：您可以清晰地追踪和管理每个人的使用情况，轻松应对设备滥用或权限回收的需求。
  * **灵活性**：为不同的人设置不同的设备上限，按需分配资源。
  * **无缝体验**：吊销用户时，系统会自动执行“无缝凭据轮换”，被吊销的用户会在宽限期后失效，而其他正常用户只需在客户端更新一次订阅即可平滑过渡，几乎无感知。

-----

## **3. 命令参考**

所有用户管理都通过 `edgeboxctl sub` 子命令完成。

| 命令 | 功能说明 |
| :--- | :--- |
| `edgeboxctl sub issue <用户名> [设备数]` | **（核心）** 为指定用户签发一个新的订阅链接。可以选填设备数量上限，默认为3。 |
| `edgeboxctl sub show` | **（常用）** 显示所有已签发的用户列表、他们的订阅链接、设备限制、以及当前已绑定的设备详情。 |
| `edgeboxctl sub revoke <用户名> [--force]` | **（重要）** 吊销指定用户的订阅链接。默认有24小时宽限期，使用 `--force` 参数则立即失效。 |
| `edgeboxctl sub limit <用户名> <数量>` | 修改已存在的用户的设备数量上限。 |

### **使用示例**

  * **为 “alice” 创建一个最多支持5台设备的订阅链接：**

    ```bash
    edgeboxctl sub issue alice 5
    ```

    执行后，屏幕上会直接显示出 `alice` 的专属订阅 URL。

  * **查看所有用户的使用情况：**

    ```bash
    edgeboxctl sub show
    ```

    您会看到类似下面的报告：

    ```
    [1] User: alice
        Active: true
        URL: http://<您的IP>/share/u-aBcDeFgH123...
        Limit: 2 / 5（7天自动释放...）
        Devices:
        - Clash.Meta for Android ... | last_seen=... | v4=✓ v6=-
        - v2rayN ... | last_seen=... | v4=✓ v6=-
    ```

  * **吊销 “alice” 的访问权限：**

    ```bash
    edgeboxctl sub revoke alice
    ```

    系统会提示您无缝轮换已启动，`alice` 的设备将在24小时后无法连接，而其他用户不受影响。

-----

### **技术细节：设备指纹是如何工作的？**

为了精确统计设备数量，EdgeBox 会根据客户端更新订阅时提供的 **User-Agent**（客户端类型和版本）和**来源 IP 的网段**生成一个独一无二的“设备指纹”。

  * **自动释放**：如果一个设备指纹在 **7天** 内没有再次更新订阅的记录，系统会自动将其从已绑定列表中移除，释放出一个设备空位。
  * **双栈网络宽限**：系统能智能识别 IPv4/IPv6 双栈网络。如果同一设备在24小时内先后通过 IPv4 和 IPv6 更新订阅，系统会将其识别为**同一台设备**，而不会占用两个名额。

