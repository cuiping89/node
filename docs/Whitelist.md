# EdgeBox 出站分流白名单维护指南 (v1.0)

本文档旨在说明 `direct-resi`（智能分流）模式下，如何科学、安全地维护域名白名单，以在节省代理流量和保护账号画像纯净度之间取得最佳平衡。

## 1. 什么是白名单？

在 `direct-resi` 模式下，EdgeBox 会对所有出站流量进行判断：

* **目标域名在白名单中**：流量将通过 **VPS 的 IP 直接连接**。这部分流量不消耗您的代理流量。
* **目标域名不在白名单中**：流量将通过您配置的 **代理（Residential IP）连接**。这部分流量用于维持您在该网站上的“干净”账号画像。

因此，白名单的维护至关重要。一个好的白名单可以让您节省高达90%的代理流量，而一个糟糕的白名单则可能导致您的账号被网站风控。

## 2. 核心维护原则

**只将承载大流量且与账号身份弱关联的 CDN 域名加入白名单。**

通俗地讲，就是把“干活的牛”（传输视频、大文件的服务器）和“发指令的人”（登录、点赞、评论的服务器）分开。我们让“牛”走直连，让“人”走代理。

| 类别 | 流量特征 | 账号画像影响 | 示例 | 建议操作 |
| :--- | :--- | :--- | :--- | :--- |
| **应用/API域名** | 流量小，但包含用户认证、行为、元数据 | **极高** | `youtube.com`, `netflix.com`, `googleapis.com` | **严禁**加入白名单（必须走代理） |
| **CDN域名** | 流量巨大，主要是视频、音频、大文件数据块 | **极低** | `googlevideo.com`, `nflxvideo.net` | **强烈推荐**加入白名单（可以直连） |

## 3. 推荐的默认白名单 (美区)

基于上述原则，我们为美区主流流媒体服务筛选了以下核心CDN域名。这个列表旨在最大化节省流量，同时将账号画像风险降至最低。

### 核心原则

  * **账号画像（走代理）**：处理用户登录、认证、浏览历史、点赞、评论、支付等个性化交互的域名。这些是“高价值、低流量”的请求。
  * **CDN 内容（可直连）**：处理视频、音频、图片、软件下载等大体积文件传输的域名。这些是“低价值、高流量”的请求。

### 美区主流网站白名单分析与建议

| 域名 | 流量类型 | 账号画像影响 | 建议操作 (在 `direct-resi` 模式下) |
| :--- | :--- | :--- | :--- |
| **--- YouTube (Google) ---** |
| `youtube.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `youtu.be` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `googleapis.com`| **核心认证/API** | **极高** | **必须走代理** (从白名单移除) |
| `googlevideo.com`| **视频流数据 (CDN)**| **极低** | **可安全直连** (保留在白名单) |
| `ytimg.com` | 静态图片 (CDN) | 较低 | 建议走代理 (从白名单移除) |
| `ggpht.com` | 静态图片 (CDN) | 较低 | 建议走代理 (从白名单移除) |
| `gstatic.com` | 静态脚本/样式 (CDN)| 较低 | 建议走代理 (从白名单移除) |
| **--- Netflix ---** |
| `netflix.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `nflxvideo.net` | **视频流数据 (CDN)** | **极低** | **可安全直连** (加入白名单) |
| `nflximg.net` | 静态图片 (CDN) | 较低 | 建议走代理 (从白名单移除) |
| `nflxso.net` | 静态脚本/对象 (CDN) | 较低 | 建议走代理 (从白名单移除) |
| **--- Disney+ / Hulu ---** |
| `disneyplus.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `hulu.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `disneystreaming.com`| **核心认证/API** | **极高** | **必须走代理** (从白名单移除) |
| `dssott.com` | **视频流数据 (CDN)** | **极低** | **可安全直连** (加入白名单) |
| **--- Amazon (Prime Video / Twitch) ---** |
| `amazon.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `primevideo.com`| **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `twitch.tv` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `aiv-cdn.net` | **Prime Video 视频 (CDN)**| **极低** | **可安全直连** (加入白名单) |
| `aiv-delivery.net`| **Prime Video 视频 (CDN)**| **极低** | **可安全直连** (加入白名单) |
| `ttvnw.net` | **Twitch 直播流 (CDN)**| **极低** | **可安全直连** (加入白名单) |
| **--- HBO Max (Max) ---** |
| `max.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `hbomax.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `hbo-cdn.com` | **视频流数据 (CDN)** | **极低** | **可安全直连** (加入白名单) |
| **--- Apple (TV+ / Music) ---** |
| `apple.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `music.apple.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `tv.apple.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `hls.itunes.apple.com` | **音/视频流数据 (CDN)** | **极低** | **可安全直连** (加入白名单) |
| **--- Spotify ---** |
| `spotify.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `scdn.co` | **音频流/图片 (CDN)** | **极低** | **可安全直连** (加入白名单) |
| **--- TikTok ---** |
| `tiktok.com` | **核心交互/API** | **极高** | **必须走代理** (从白名单移除) |
| `tiktokcdn.com` | **视频流数据 (CDN)** | **极低** | **可安全直连** (加入白名单) |

-----

### 最终推荐的白名单列表

根据以上表格，最终整合出的**推荐默认白名单**如下。您可以直接复制这个列表用于更新您脚本中的 `WHITELIST_DOMAINS` 变量。

```
# YouTube
googlevideo.com
# Netflix
nflxvideo.net
# Disney+ / Hulu
dssott.com
# Amazon Prime Video
aiv-cdn.net
aiv-delivery.net
# Twitch
ttvnw.net
# HBO Max (Max)
hbo-cdn.com
# Apple TV+ / Music
hls.itunes.apple.com
# Spotify
scdn.co
# TikTok
tiktokcdn.com
```
这个列表为您涵盖了美区最主流的“流量大户”，在确保账号安全的前提下，最大限度地节省了您的代理流量。

## 4. 如何管理白名单

请使用 `edgeboxctl` 工具进行白名单的增、删、查、改操作。

#### 查看当前白名单
```bash
edgeboxctl shunt whitelist list
```

#### 添加一个域名到白名单
例如，添加 `example-cdn.com`：
```bash
edgeboxctl shunt whitelist add example-cdn.com
```

#### 从白名单中移除一个域名
例如，移除 `example-cdn.com`：
```bash
edgeboxctl shunt whitelist remove example-cdn.com
```

#### 恢复为推荐的默认白名单
此命令会清空现有列表，并用脚本内置的推荐列表覆盖。
```bash
edgeboxctl shunt whitelist reset
```

> **[!] 重要提示**
>
> 在您**修改（添加、删除、重置）了白名单之后**，新的列表不会自动生效。您必须**重新执行一次 `shunt direct-resi` 命令**来让 Xray 加载新的规则。
> ```bash
> # 在修改完白名单后，执行此命令以应用更改
> edgeboxctl shunt direct-resi '您的代理URL'
> ```

## 5. 高级技巧与注意事项

* **如何发现新的CDN域名？**
    当您在浏览器中播放某个视频时，可以打开“开发者工具”（通常按 F12），切换到“网络(Network)”选项卡，并按“大小(Size)”排序。您会看到一些体积非常大的文件（通常是 `.mp4`, `.ts`, `.m4s` 等格式），查看这些请求的域名，通常就是该服务的CDN域名。

* **“少即是多”原则**
    白名单并非越全越好。当不确定一个域名是否为纯CDN时，最安全的做法是**不添加**它，让它继续走代理。我们的目标是分流那些真正消耗巨大流量的域名，而不是追求100%的资源分流。

* **地理区域差异**
    本指南提供的列表主要基于美区服务。如果您使用的代理位于其他地区（如日本、新加坡），这些服务的CDN域名可能会有所不同。您可以根据上述“如何发现”的方法自行探索和添加。
