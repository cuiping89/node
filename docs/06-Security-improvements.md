# EdgeBox å®‰å…¨æ”¹è¿›æŠ€æœ¯æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´  
> **æœ€åæ›´æ–°**: 2025å¹´  
> **æ–‡æ¡£ç”¨é€”**: æŒ‡å¯¼EdgeBoxå®‰å…¨åŠŸèƒ½æ”¹è¿›å¼€å‘

---

## ğŸ“‹ ç›®å½•

1. [æ”¹è¿›æ¦‚è¿°](#æ”¹è¿›æ¦‚è¿°)
2. [Realityå¯†é’¥è½®æ¢ç³»ç»Ÿ](#realityå¯†é’¥è½®æ¢ç³»ç»Ÿ)
3. [SNIåŸŸåæ± æ™ºèƒ½ç®¡ç†](#sniåŸŸåæ± æ™ºèƒ½ç®¡ç†)
4. [æµé‡ç‰¹å¾éšæœºåŒ–](#æµé‡ç‰¹å¾éšæœºåŒ–)
5. [å®æ–½ä¼˜å…ˆçº§ä¸è·¯çº¿å›¾](#å®æ–½ä¼˜å…ˆçº§ä¸è·¯çº¿å›¾)
6. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)
7. [æµ‹è¯•éªŒè¯æ–¹æ¡ˆ](#æµ‹è¯•éªŒè¯æ–¹æ¡ˆ)
8. [ç»´æŠ¤ä¸ç›‘æ§](#ç»´æŠ¤ä¸ç›‘æ§)

---

## æ”¹è¿›æ¦‚è¿°

### å®‰å…¨ç†è®ºåŸºç¡€

åŸºäºç°ä»£ç½‘ç»œå®‰å…¨åˆ†æï¼ŒEdgeBoxçš„å®‰å…¨æ”¹è¿›éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

- **åŠ å¯†æ­£ç¡®æ€§**ï¼šåœ°åŸºçº§å®‰å…¨ï¼Œç¡®ä¿å¯†ç å­¦å®ç°æ— è¯¯
- **æµé‡å½¢æ€ä¼˜åŒ–**ï¼šé™ä½è¢«DPI/æŒ‡çº¹è¯†åˆ«çš„æ¦‚ç‡
- **ç«¯ç‚¹ä¿¡èª‰ä¿æŠ¤**ï¼šé¿å…IP/åŸŸåè¢«"è¸©çƒ­"
- **è¿ç»´å®‰å…¨å«ç”Ÿ**ï¼šæœ€å°åŒ–é…ç½®æ³„éœ²å’Œæ“ä½œç—•è¿¹

### æ”¹è¿›é¡¹ç›®æ¸…å•

| ä¼˜å…ˆçº§ | é¡¹ç›®åç§° | å®‰å…¨ä»·å€¼ | å®æ–½å¤æ‚åº¦ | ç”¨æˆ·å½±å“ |
|--------|----------|----------|------------|----------|
| ğŸ”¥ æœ€é«˜ | Realityå¯†é’¥è½®æ¢ | â­â­â­â­â­ | â­â­â­ | è½»å¾® |
| ğŸ”¥ æœ€é«˜ | SNIåŸŸåæ± ç®¡ç† | â­â­â­â­â­ | â­â­ | æ—  |
| ğŸš€ é«˜ | æµé‡ç‰¹å¾éšæœºåŒ– | â­â­â­â­ | â­â­â­ | æ—  |

---

## Realityå¯†é’¥è½®æ¢ç³»ç»Ÿ

### åŠŸèƒ½éœ€æ±‚

#### æ ¸å¿ƒç›®æ ‡
- **å®šæœŸè½®æ¢Realityå¯†é’¥å¯¹**ï¼šé¿å…é•¿æœŸä½¿ç”¨åŒä¸€å¯†é’¥çš„å®‰å…¨é£é™©
- **æ— ç¼ç”¨æˆ·ä½“éªŒ**ï¼šåˆ©ç”¨å¤šåè®®å¤‡ç”¨ç¡®ä¿è¿æ¥è¿ç»­æ€§
- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šæœ€å°åŒ–äººå·¥å¹²é¢„ï¼Œæ”¯æŒè®¡åˆ’ä»»åŠ¡

#### æŠ€æœ¯æŒ‡æ ‡
- **è½®æ¢å‘¨æœŸ**ï¼š90å¤©ï¼ˆå›ºå®šï¼Œä¸å¯é…ç½®ï¼‰
- **é€šçŸ¥æå‰æœŸ**ï¼š7å¤©
- **å¤‡ç”¨åè®®**ï¼šHysteria2 (UDP 443)ã€TUIC (UDP 2053)
- **å¯ç”¨æ€§ç›®æ ‡**ï¼š99.9%ï¼ˆè½®æ¢è¿‡ç¨‹ä¸­æ–­æ—¶é—´<1åˆ†é’Ÿï¼‰

### æŠ€æœ¯è®¾è®¡

#### æ•°æ®ç»“æ„è®¾è®¡

```json
{
  "reality": {
    "current": {
      "private_key": "xxx",
      "public_key": "yyy", 
      "short_id": "zzz",
      "created_at": "2025-01-01T00:00:00Z",
      "expires_at": "2025-04-01T00:00:00Z"
    },
    "rotation": {
      "last_rotation": "2025-01-01T00:00:00Z",
      "next_rotation": "2025-04-01T00:00:00Z",
      "rotation_count": 1,
      "auto_rotation_enabled": true
    },
    "backup": {
      "previous_public_key": "aaa",
      "rotation_history": [
        {"date": "2025-01-01T00:00:00Z", "public_key": "bbb"}
      ]
    }
  }
}
```

#### æ ¸å¿ƒå‡½æ•°æ¥å£

```bash
# edgeboxctl æ–°å¢å‘½ä»¤
edgeboxctl security reality rotate [--force]
edgeboxctl security reality status
edgeboxctl security reality schedule [--enable|--disable]
edgeboxctl security reality history [--limit=10]
```

#### å®ç°ç®—æ³•æµç¨‹

```mermaid
graph TD
    A[æ£€æŸ¥è½®æ¢æ—¶é—´] --> B{æ˜¯å¦åˆ°æœŸ?}
    B -->|å¦| C[ç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥]
    B -->|æ˜¯| D[ç”Ÿæˆæ–°å¯†é’¥å¯¹]
    D --> E[å¤‡ä»½å½“å‰å¯†é’¥]
    E --> F[æ›´æ–°Xrayé…ç½®]
    F --> G[é‡å¯XrayæœåŠ¡]
    G --> H[æ›´æ–°è®¢é˜…é“¾æ¥]
    H --> I[å‘é€ç”¨æˆ·é€šçŸ¥]
    I --> J[è®°å½•è½®æ¢æ—¥å¿—]
    J --> K[è®¾ç½®ä¸‹æ¬¡è½®æ¢æ—¶é—´]
    K --> C
```

### å…³é”®ä»£ç ç‰‡æ®µ

#### å¯†é’¥ç”Ÿæˆå‡½æ•°
```bash
generate_new_reality_keypair() {
    local reality_output
    reality_output="$(sing-box generate reality-keypair 2>/dev/null)"
    
    if [[ -z "$reality_output" ]]; then
        log_error "Realityå¯†é’¥ç”Ÿæˆå¤±è´¥"
        return 1
    fi
    
    local new_private_key new_public_key new_short_id
    new_private_key="$(echo "$reality_output" | grep -oP 'PrivateKey: \K[a-zA-Z0-9_-]+' | head -1)"
    new_public_key="$(echo "$reality_output" | grep -oP 'PublicKey: \K[a-zA-Z0-9_-]+' | head -1)"
    new_short_id="$(openssl rand -hex 4)"
    
    # éªŒè¯å¯†é’¥æœ‰æ•ˆæ€§
    if [[ ${#new_private_key} -lt 32 || ${#new_public_key} -lt 32 ]]; then
        log_error "ç”Ÿæˆçš„å¯†é’¥é•¿åº¦ä¸è¶³"
        return 1
    fi
    
    echo "$new_private_key|$new_public_key|$new_short_id"
}
```

#### é…ç½®æ›´æ–°å‡½æ•°
```bash
update_reality_config() {
    local new_private_key="$1"
    local new_public_key="$2"
    local new_short_id="$3"
    
    # å¤‡ä»½å½“å‰é…ç½®
    cp "${CONFIG_DIR}/xray.json" "${CONFIG_DIR}/xray.json.backup.$(date +%s)"
    
    # ä½¿ç”¨jqå®‰å…¨æ›´æ–°é…ç½®
    jq --arg private_key "$new_private_key" \
       --arg short_id "$new_short_id" '
        (.inbounds[] | select(.tag | contains("reality")) | 
         .streamSettings.realitySettings.privateKey) = $private_key |
        (.inbounds[] | select(.tag | contains("reality")) | 
         .streamSettings.realitySettings.shortId) = [$short_id]
    ' "${CONFIG_DIR}/xray.json" > "${CONFIG_DIR}/xray.json.tmp"
    
    # éªŒè¯JSONæ ¼å¼
    if jq '.' "${CONFIG_DIR}/xray.json.tmp" >/dev/null 2>&1; then
        mv "${CONFIG_DIR}/xray.json.tmp" "${CONFIG_DIR}/xray.json"
        return 0
    else
        log_error "æ›´æ–°åçš„é…ç½®æ–‡ä»¶JSONæ ¼å¼é”™è¯¯"
        rm -f "${CONFIG_DIR}/xray.json.tmp"
        return 1
    fi
}
```

#### è½®æ¢è°ƒåº¦å™¨
```bash
setup_reality_rotation_schedule() {
    local cron_entry="0 2 */90 * * /usr/local/bin/edgeboxctl security reality rotate --auto >/dev/null 2>&1"
    
    # æ·»åŠ åˆ°crontab
    (crontab -l 2>/dev/null; echo "$cron_entry") | sort -u | crontab -
    
    log_success "Realityå¯†é’¥è½®æ¢è®¡åˆ’å·²è®¾ç½®ï¼šæ¯90å¤©è‡ªåŠ¨è½®æ¢"
}
```

---

## SNIåŸŸåæ± æ™ºèƒ½ç®¡ç†

### åŠŸèƒ½éœ€æ±‚

#### æ ¸å¿ƒç›®æ ‡
- **åŠ¨æ€SNIåŸŸåé€‰æ‹©**ï¼šé¿å…å›ºå®šä½¿ç”¨å•ä¸€åŸŸåè¢«é’ˆå¯¹
- **æ™ºèƒ½è¯„åˆ†ç®—æ³•**ï¼šåŸºäºå¯è¾¾æ€§ã€çƒ­åº¦ã€åœ°ç†ä½ç½®é€‰æ‹©æœ€ä¼˜åŸŸå
- **è‡ªåŠ¨è½®æ¢æœºåˆ¶**ï¼šå®šæœŸæ›´æ¢SNIåŸŸåï¼Œé™ä½è¯†åˆ«é£é™©

#### æŠ€æœ¯æŒ‡æ ‡
- **åŸŸåæ± å¤§å°**ï¼š5-8ä¸ªå¤‡é€‰åŸŸå
- **è½®æ¢é¢‘ç‡**ï¼šæ¯7å¤©æˆ–æ£€æµ‹åˆ°å¼‚å¸¸æ—¶
- **å¯è¾¾æ€§è¦æ±‚**ï¼š>95%æˆåŠŸç‡
- **ç”¨æˆ·å½±å“**ï¼šå®Œå…¨é€æ˜ï¼Œé…ç½®æ— éœ€å˜æ›´

### æŠ€æœ¯è®¾è®¡

#### åŸŸåæ± é…ç½®

```bash
# ç²¾é€‰SNIåŸŸåæ± 
SNI_DOMAIN_POOL=(
    "www.microsoft.com"      # æƒé‡: 25 (ç¨³å®šæ€§é«˜)
    "www.apple.com"          # æƒé‡: 20 (å…¨çƒè¦†ç›–)
    "www.cloudflare.com"     # æƒé‡: 20 (ç½‘ç»œå‹å¥½)
    "azure.microsoft.com"    # æƒé‡: 15 (ä¼ä¸šçº§)
    "aws.amazon.com"         # æƒé‡: 10 (å¤‡ç”¨)
    "www.fastly.com"         # æƒé‡: 10 (CDNç‰¹æ€§)
)
```

#### æ™ºèƒ½è¯„åˆ†ç®—æ³•

```bash
# åŸŸåè¯„åˆ†å‡½æ•°
evaluate_sni_domain() {
    local domain="$1"
    local score=0
    
    # å¯è¾¾æ€§æµ‹è¯• (40åˆ†)
    if curl -s --connect-timeout 3 --max-time 5 "https://${domain}" >/dev/null 2>&1; then
        score=$((score + 40))
    fi
    
    # å“åº”æ—¶é—´æµ‹è¯• (20åˆ†)
    local response_time
    response_time=$(curl -o /dev/null -s -w '%{time_total}' --connect-timeout 3 "https://${domain}" 2>/dev/null)
    if [[ -n "$response_time" ]] && (( $(echo "$response_time < 2.0" | bc -l) )); then
        score=$((score + 20))
    fi
    
    # åŸŸåçƒ­åº¦æ£€æŸ¥ (20åˆ†) - é¿å…è¿‡çƒ­åŸŸå
    local heat_score
    heat_score=$(check_domain_heat_score "$domain")
    score=$((score + heat_score))
    
    # åœ°ç†ä½ç½®ä¼˜åŒ– (20åˆ†)
    if is_domain_geo_optimal "$domain"; then
        score=$((score + 20))
    fi
    
    echo "$score"
}
```

#### è‡ªåŠ¨è½®æ¢é€»è¾‘

```bash
auto_rotate_sni_domain() {
    log_info "å¼€å§‹SNIåŸŸåæ™ºèƒ½é€‰æ‹©..."
    
    local best_domain=""
    local best_score=0
    
    # è¯„ä¼°æ‰€æœ‰å€™é€‰åŸŸå
    for domain in "${SNI_DOMAIN_POOL[@]}"; do
        local score
        score=$(evaluate_sni_domain "$domain")
        
        log_debug "åŸŸå $domain è¯„åˆ†: $score"
        
        if [[ $score -gt $best_score ]]; then
            best_score=$score
            best_domain="$domain"
        fi
    done
    
    # æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ¢
    local current_sni
    current_sni=$(jq -r '.inbounds[] | select(.tag | contains("reality")) | .streamSettings.realitySettings.dest' "${CONFIG_DIR}/xray.json" | head -1 | cut -d: -f1)
    
    if [[ "$best_domain" == "$current_sni" ]]; then
        log_info "å½“å‰SNIåŸŸå $current_sni ä»ä¸ºæœ€ä¼˜ï¼Œæ— éœ€æ›´æ¢"
        return 0
    fi
    
    # æ‰§è¡Œæ›´æ¢
    log_info "æ›´æ¢SNIåŸŸå: $current_sni â†’ $best_domain (è¯„åˆ†: $best_score)"
    
    update_sni_domain "$best_domain"
}
```

### å®ç°è¦ç‚¹

#### é…ç½®æ›´æ–°ç­–ç•¥
- ä½¿ç”¨`jq`å®‰å…¨ä¿®æ”¹JSONé…ç½®
- æ”¯æŒ`systemctl reload`çƒ­é‡è½½
- é…ç½®éªŒè¯ä¸å›æ»šæœºåˆ¶

#### ç›‘æ§ä¸æ—¥å¿—
- è®°å½•æ¯æ¬¡åŸŸåè¯„åˆ†å’Œé€‰æ‹©è¿‡ç¨‹
- ç»Ÿè®¡åŸŸåä½¿ç”¨æ—¶é•¿å’Œç¨³å®šæ€§
- å¼‚å¸¸æƒ…å†µè‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨åŸŸå

---

## æµé‡ç‰¹å¾éšæœºåŒ–

### åŠŸèƒ½éœ€æ±‚

#### æ ¸å¿ƒç›®æ ‡
- **åè®®å‚æ•°éšæœºåŒ–**ï¼šé¿å…å›ºå®šå‚æ•°å½¢æˆå¯è¯†åˆ«æŒ‡çº¹
- **è¡Œä¸ºæ¨¡å¼å¤šæ ·åŒ–**ï¼šæ¨¡æ‹ŸçœŸå®ä¸šåŠ¡æµé‡ç‰¹å¾
- **æ€§èƒ½ä¿æŒä¼˜åŒ–**ï¼šéšæœºåŒ–ä¸èƒ½æ˜¾è‘—å½±å“è¿æ¥æ€§èƒ½

#### è¦†ç›–èŒƒå›´
- **Hysteria2**: å¿ƒè·³é—´éš”ã€æ‹¥å¡æ§åˆ¶ã€ä¼ªè£…ç½‘ç«™
- **TUIC**: æ‹¥å¡æ§åˆ¶ç®—æ³•ã€è®¤è¯è¶…æ—¶
- **VLESS**: WebSocketè·¯å¾„ã€gRPCæœåŠ¡å

### æŠ€æœ¯è®¾è®¡

#### éšæœºåŒ–å‚æ•°å®šä¹‰

```bash
# Hysteria2éšæœºåŒ–å‚æ•°
HYSTERIA2_HEARTBEAT_RANGE=(8 15)           # å¿ƒè·³é—´éš”: 8-15ç§’
HYSTERIA2_CONGESTION_ALGOS=("bbr" "cubic" "reno")
HYSTERIA2_MASQUERADE_SITES=(
    "https://www.bing.com"
    "https://www.apple.com"
    "https://azure.microsoft.com"
    "https://aws.amazon.com"
)

# TUICéšæœºåŒ–å‚æ•°
TUIC_CONGESTION_ALGOS=("bbr" "cubic")
TUIC_AUTH_TIMEOUT_RANGE=(3 8)              # è®¤è¯è¶…æ—¶: 3-8ç§’

# VLESSéšæœºåŒ–å‚æ•°
VLESS_WS_PATHS=("/ws" "/websocket" "/v2ray" "/proxy" "/tunnel")
VLESS_GRPC_SERVICES=("GunService" "TunService" "ProxyService")
```

#### éšæœºåŒ–æ‰§è¡Œå‡½æ•°

```bash
randomize_hysteria2_config() {
    log_info "éšæœºåŒ–Hysteria2æµé‡ç‰¹å¾..."
    
    # ç”Ÿæˆéšæœºå‚æ•°
    local heartbeat=$((${HYSTERIA2_HEARTBEAT_RANGE[0]} + RANDOM % (${HYSTERIA2_HEARTBEAT_RANGE[1]} - ${HYSTERIA2_HEARTBEAT_RANGE[0]} + 1)))
    local congestion_algo="${HYSTERIA2_CONGESTION_ALGOS[RANDOM % ${#HYSTERIA2_CONGESTION_ALGOS[@]}]}"
    local masquerade_site="${HYSTERIA2_MASQUERADE_SITES[RANDOM % ${#HYSTERIA2_MASQUERADE_SITES[@]}]}"
    
    log_debug "Hysteria2å‚æ•°: å¿ƒè·³=${heartbeat}s, æ‹¥å¡æ§åˆ¶=$congestion_algo, ä¼ªè£…=$masquerade_site"
    
    # æ›´æ–°sing-boxé…ç½®
    jq --arg heartbeat "${heartbeat}s" \
       --arg congestion "$congestion_algo" \
       --arg masquerade "$masquerade_site" '
        (.inbounds[] | select(.type == "hysteria2") | .heartbeat) = $heartbeat |
        (.inbounds[] | select(.type == "hysteria2") | .congestion_control) = $congestion |
        (.inbounds[] | select(.type == "hysteria2") | .masquerade) = $masquerade
    ' "${CONFIG_DIR}/sing-box.json" > "${CONFIG_DIR}/sing-box.json.tmp"
    
    if jq '.' "${CONFIG_DIR}/sing-box.json.tmp" >/dev/null 2>&1; then
        mv "${CONFIG_DIR}/sing-box.json.tmp" "${CONFIG_DIR}/sing-box.json"
        return 0
    else
        rm -f "${CONFIG_DIR}/sing-box.json.tmp"
        return 1
    fi
}
```

#### è°ƒåº¦ç­–ç•¥

```bash
# éšæœºåŒ–è°ƒåº¦é…ç½®
RANDOMIZATION_SCHEDULE=(
    "daily"     # æ¯å¤©è½»åº¦éšæœºåŒ–
    "weekly"    # æ¯å‘¨ä¸­åº¦éšæœºåŒ–
    "monthly"   # æ¯æœˆé‡åº¦éšæœºåŒ–
)

setup_traffic_randomization_schedule() {
    # æ¯å¤©å‡Œæ™¨4ç‚¹è½»åº¦éšæœºåŒ–
    echo "0 4 * * * /usr/local/bin/edgeboxctl traffic randomize --level=light >/dev/null 2>&1" >> /tmp/edgebox_cron
    
    # æ¯å‘¨æ—¥å‡Œæ™¨5ç‚¹ä¸­åº¦éšæœºåŒ–
    echo "0 5 * * 0 /usr/local/bin/edgeboxctl traffic randomize --level=medium >/dev/null 2>&1" >> /tmp/edgebox_cron
    
    # æ¯æœˆ1å·å‡Œæ™¨6ç‚¹é‡åº¦éšæœºåŒ–
    echo "0 6 1 * * /usr/local/bin/edgeboxctl traffic randomize --level=heavy >/dev/null 2>&1" >> /tmp/edgebox_cron
}
```

---

## å®æ–½ä¼˜å…ˆçº§ä¸è·¯çº¿å›¾

### å¼€å‘é˜¶æ®µè§„åˆ’

#### é˜¶æ®µ1: åŸºç¡€åŠŸèƒ½å®ç° (Week 1-2)
- [x] **Realityå¯†é’¥è½®æ¢æ ¸å¿ƒé€»è¾‘**
  - å¯†é’¥ç”Ÿæˆä¸éªŒè¯
  - é…ç½®æ›´æ–°ä¸å¤‡ä»½
  - åŸºç¡€è½®æ¢å‘½ä»¤
- [x] **SNIåŸŸåæ± åŸºç¡€åŠŸèƒ½**
  - åŸŸåæ± å®šä¹‰ä¸ç®¡ç†
  - ç®€å•è½®æ¢é€»è¾‘
  - é…ç½®æ›´æ–°æœºåˆ¶

#### é˜¶æ®µ2: æ™ºèƒ½åŒ–å¢å¼º (Week 3-4)
- [x] **æ™ºèƒ½åŸŸåé€‰æ‹©ç®—æ³•**
  - å¤šç»´åº¦è¯„åˆ†ç³»ç»Ÿ
  - è‡ªåŠ¨å¼‚å¸¸æ£€æµ‹
  - æ€§èƒ½ä¼˜åŒ–
- [x] **æµé‡éšæœºåŒ–ç³»ç»Ÿ**
  - å¤šåè®®å‚æ•°éšæœºåŒ–
  - åˆ†çº§éšæœºåŒ–ç­–ç•¥
  - æ€§èƒ½å½±å“æœ€å°åŒ–

#### é˜¶æ®µ3: è‡ªåŠ¨åŒ–å®Œå–„ (Week 5-6)
- [x] **å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ**
  - Cronä»»åŠ¡é…ç½®
  - é”™è¯¯å¤„ç†ä¸é‡è¯•
  - æ—¥å¿—è®°å½•ä¸ç›‘æ§
- [x] **ç”¨æˆ·é€šçŸ¥ç³»ç»Ÿ**
  - é‚®ä»¶é€šçŸ¥æ”¯æŒ
  - Dashboardé›†æˆ
  - ç§»åŠ¨ç«¯æ¨é€(å¯é€‰)

#### é˜¶æ®µ4: æµ‹è¯•ä¸ä¼˜åŒ– (Week 7-8)
- [x] **å…¨é¢æµ‹è¯•éªŒè¯**
  - åŠŸèƒ½æµ‹è¯•
  - æ€§èƒ½æµ‹è¯•  
  - ç¨³å®šæ€§æµ‹è¯•
- [x] **æ–‡æ¡£ä¸åŸ¹è®­**
  - ç”¨æˆ·æ‰‹å†Œæ›´æ–°
  - è¿ç»´æŒ‡å—ç¼–å†™
  - æ•…éšœæ’é™¤æ–‡æ¡£

### æŠ€æœ¯ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[Realityå¯†é’¥è½®æ¢] --> D[å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ]
    B[SNIåŸŸåæ± ] --> D
    C[æµé‡éšæœºåŒ–] --> D
    D --> E[ç”¨æˆ·é€šçŸ¥ç³»ç»Ÿ]
    D --> F[ç›‘æ§ä¸æ—¥å¿—]
    E --> G[å®Œæ•´æµ‹è¯•]
    F --> G
```

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### æ ¸å¿ƒæ¨¡å—ç»“æ„

```bash
# EdgeBoxå®‰å…¨æ¨¡å—ç›®å½•ç»“æ„
/etc/edgebox/security/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ reality-rotation.sh      # Realityå¯†é’¥è½®æ¢
â”‚   â”œâ”€â”€ sni-pool.sh             # SNIåŸŸåæ± ç®¡ç†
â”‚   â”œâ”€â”€ traffic-randomize.sh    # æµé‡ç‰¹å¾éšæœºåŒ–
â”‚   â””â”€â”€ notification.sh         # é€šçŸ¥ç³»ç»Ÿ
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ security.conf           # å®‰å…¨é…ç½®
â”‚   â”œâ”€â”€ sni-domains.json        # SNIåŸŸåæ± 
â”‚   â””â”€â”€ randomization.json      # éšæœºåŒ–å‚æ•°
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ rotation.log            # è½®æ¢æ—¥å¿—
â”‚   â”œâ”€â”€ sni-selection.log       # åŸŸåé€‰æ‹©æ—¥å¿—
â”‚   â””â”€â”€ randomization.log       # éšæœºåŒ–æ—¥å¿—
â””â”€â”€ backup/
    â”œâ”€â”€ keys/                   # å¯†é’¥å¤‡ä»½
    â””â”€â”€ configs/                # é…ç½®å¤‡ä»½
```

### é…ç½®æ–‡ä»¶æ ¼å¼

#### security.conf
```ini
# EdgeBoxå®‰å…¨é…ç½®
[reality]
rotation_enabled=true
rotation_days=90
notification_days=7
backup_count=5

[sni]
pool_enabled=true
rotation_frequency=weekly
health_check_interval=3600

[traffic]
randomization_enabled=true
light_schedule="0 4 * * *"
medium_schedule="0 5 * * 0" 
heavy_schedule="0 6 1 * *"

[notification]
email_enabled=false
webhook_enabled=false
dashboard_enabled=true
```

#### sni-domains.json
```json
{
  "domains": [
    {
      "hostname": "www.microsoft.com",
      "weight": 25,
      "category": "tech-giant",
      "region": "global",
      "last_used": "2025-01-01T00:00:00Z",
      "success_rate": 0.98
    },
    {
      "hostname": "www.apple.com", 
      "weight": 20,
      "category": "tech-giant",
      "region": "global",
      "last_used": "2024-12-25T00:00:00Z",
      "success_rate": 0.97
    }
  ],
  "selection_history": [
    {
      "timestamp": "2025-01-01T00:00:00Z",
      "selected": "www.microsoft.com",
      "score": 85,
      "reason": "highest_score"
    }
  ]
}
```

### é”™è¯¯å¤„ç†æœºåˆ¶

#### åˆ†çº§é”™è¯¯å¤„ç†
```bash
# é”™è¯¯çº§åˆ«å®šä¹‰
ERROR_LEVEL_INFO=0      # ä¿¡æ¯è®°å½•
ERROR_LEVEL_WARN=1      # è­¦å‘Šä½†ç»§ç»­
ERROR_LEVEL_ERROR=2     # é”™è¯¯éœ€é‡è¯•  
ERROR_LEVEL_CRITICAL=3  # å…³é”®é”™è¯¯åœæ­¢

handle_error() {
    local level=$1
    local message="$2"
    local context="$3"
    
    case $level in
        $ERROR_LEVEL_INFO)
            log_info "$message"
            ;;
        $ERROR_LEVEL_WARN)
            log_warn "$message"
            send_notification "warning" "$message"
            ;;
        $ERROR_LEVEL_ERROR)
            log_error "$message"
            attempt_recovery "$context"
            ;;
        $ERROR_LEVEL_CRITICAL)
            log_critical "$message"
            trigger_emergency_rollback "$context"
            send_alert "critical" "$message"
            ;;
    esac
}
```

#### è‡ªåŠ¨æ¢å¤ç­–ç•¥
```bash
attempt_recovery() {
    local context="$1"
    
    case $context in
        "reality_rotation")
            restore_reality_backup
            ;;
        "sni_update") 
            rollback_sni_change
            ;;
        "traffic_randomize")
            restore_default_traffic_config
            ;;
    esac
}
```

---

## æµ‹è¯•éªŒè¯æ–¹æ¡ˆ

### åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### Realityå¯†é’¥è½®æ¢æµ‹è¯•
```bash
# æµ‹è¯•ç”¨ä¾‹1: æ­£å¸¸è½®æ¢æµç¨‹
test_reality_rotation_normal() {
    # å‰ç½®æ¡ä»¶: ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
    # æ‰§è¡Œ: edgeboxctl security reality rotate
    # éªŒè¯: 
    # - æ–°å¯†é’¥ç”ŸæˆæˆåŠŸ
    # - é…ç½®æ–‡ä»¶æ›´æ–°æ­£ç¡®
    # - æœåŠ¡é‡å¯æˆåŠŸ
    # - è®¢é˜…é“¾æ¥æ›´æ–°
    # - è¿æ¥æµ‹è¯•é€šè¿‡
}

# æµ‹è¯•ç”¨ä¾‹2: è½®æ¢å¤±è´¥å›æ»š
test_reality_rotation_rollback() {
    # å‰ç½®æ¡ä»¶: æ¨¡æ‹Ÿé…ç½®æ›´æ–°å¤±è´¥
    # æ‰§è¡Œ: è½®æ¢å‘½ä»¤
    # éªŒè¯:
    # - æ£€æµ‹åˆ°é”™è¯¯
    # - è‡ªåŠ¨å›æ»šåˆ°åŸé…ç½®
    # - æœåŠ¡æ­£å¸¸è¿è¡Œ
    # - é”™è¯¯æ—¥å¿—è®°å½•
}

# æµ‹è¯•ç”¨ä¾‹3: å®šæ—¶è½®æ¢éªŒè¯
test_reality_scheduled_rotation() {
    # å‰ç½®æ¡ä»¶: è®¾ç½®æµ‹è¯•è½®æ¢æ—¶é—´
    # æ‰§è¡Œ: ç­‰å¾…å®šæ—¶ä»»åŠ¡è§¦å‘
    # éªŒè¯:
    # - è‡ªåŠ¨è½®æ¢æ‰§è¡Œ
    # - é€šçŸ¥å‘é€æˆåŠŸ
    # - æœåŠ¡ç¨³å®šè¿è¡Œ
}
```

#### SNIåŸŸåæ± æµ‹è¯•
```bash
# æµ‹è¯•ç”¨ä¾‹4: æ™ºèƒ½åŸŸåé€‰æ‹©
test_sni_intelligent_selection() {
    # å‰ç½®æ¡ä»¶: é…ç½®å¤šä¸ªæµ‹è¯•åŸŸå
    # æ‰§è¡Œ: åŸŸåé€‰æ‹©ç®—æ³•
    # éªŒè¯:
    # - è¯„åˆ†ç®—æ³•æ­£ç¡®
    # - é€‰æ‹©æœ€ä¼˜åŸŸå
    # - é…ç½®æ›´æ–°æˆåŠŸ
    # - è¿æ¥æ­£å¸¸
}

# æµ‹è¯•ç”¨ä¾‹5: åŸŸåæ•…éšœåˆ‡æ¢
test_sni_failover() {
    # å‰ç½®æ¡ä»¶: æ¨¡æ‹Ÿå½“å‰åŸŸåä¸å¯è¾¾
    # æ‰§è¡Œ: å¥åº·æ£€æŸ¥
    # éªŒè¯:
    # - æ£€æµ‹åˆ°åŸŸåæ•…éšœ
    # - è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨åŸŸå
    # - æœåŠ¡ä¸ä¸­æ–­
}
```

### æ€§èƒ½æµ‹è¯•åŸºå‡†

#### è½®æ¢æ€§èƒ½æŒ‡æ ‡
```bash
# æ€§èƒ½åŸºå‡†è¦æ±‚
ROTATION_MAX_DOWNTIME=60     # æœ€å¤§ä¸­æ–­æ—¶é—´: 60ç§’
ROTATION_MAX_DURATION=300    # æœ€å¤§è½®æ¢æ—¶é•¿: 5åˆ†é’Ÿ
SNI_UPDATE_MAX_TIME=10       # SNIæ›´æ–°æ—¶é—´: 10ç§’
CONFIG_RELOAD_MAX_TIME=5     # é…ç½®é‡è½½æ—¶é—´: 5ç§’
```

#### å‹åŠ›æµ‹è¯•æ–¹æ¡ˆ
```bash
# å¹¶å‘è¿æ¥æµ‹è¯•
stress_test_concurrent_connections() {
    # åœ¨è½®æ¢è¿‡ç¨‹ä¸­ä¿æŒ1000ä¸ªå¹¶å‘è¿æ¥
    # éªŒè¯è¿æ¥æˆåŠŸç‡ > 95%
    # éªŒè¯å¹³å‡å»¶è¿Ÿ < 200ms
}

# é•¿æœŸç¨³å®šæ€§æµ‹è¯•  
stability_test_long_term() {
    # è¿ç»­è¿è¡Œ30å¤©
    # æ¯å¤©æ‰§è¡ŒéšæœºåŒ–
    # æ¯å‘¨æ‰§è¡ŒSNIè½®æ¢
    # éªŒè¯ç³»ç»Ÿç¨³å®šè¿è¡Œ
}
```

### å®‰å…¨æµ‹è¯•éªŒè¯

#### å¯†é’¥å¼ºåº¦éªŒè¯
```bash
verify_key_strength() {
    local private_key="$1"
    local public_key="$2"
    
    # éªŒè¯å¯†é’¥é•¿åº¦
    if [[ ${#private_key} -lt 32 || ${#public_key} -lt 32 ]]; then
        return 1
    fi
    
    # éªŒè¯å¯†é’¥éšæœºæ€§
    if ! check_key_entropy "$private_key"; then
        return 1
    fi
    
    # éªŒè¯å¯†é’¥å¯¹åŒ¹é…
    if ! verify_keypair_match "$private_key" "$public_key"; then
        return 1
    fi
    
    return 0
}
```

#### é…ç½®å®‰å…¨æ£€æŸ¥
```bash
security_audit_configs() {
    # æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ³„éœ²
    check_sensitive_data_exposure
    
    # éªŒè¯æ–‡ä»¶æƒé™
    verify_config_file_permissions
    
    # æ£€æŸ¥æ—¥å¿—å®‰å…¨
    audit_log_sensitivity
    
    # éªŒè¯å¤‡ä»½åŠ å¯†
    verify_backup_encryption
}
```

---

## ç»´æŠ¤ä¸ç›‘æ§

### ç›‘æ§æŒ‡æ ‡å®šä¹‰

#### ç³»ç»Ÿå¥åº·æŒ‡æ ‡
```bash
# æ ¸å¿ƒç›‘æ§æŒ‡æ ‡
METRICS=(
    "reality_rotation_success_rate"     # Realityè½®æ¢æˆåŠŸç‡
    "sni_selection_response_time"       # SNIé€‰æ‹©å“åº”æ—¶é—´  
    "traffic_randomization_frequency"   # æµé‡éšæœºåŒ–é¢‘ç‡
    "config_update_duration"            # é…ç½®æ›´æ–°è€—æ—¶
    "service_restart_success_rate"      # æœåŠ¡é‡å¯æˆåŠŸç‡
    "connection_success_rate"           # è¿æ¥æˆåŠŸç‡
    "average_connection_latency"        # å¹³å‡è¿æ¥å»¶è¿Ÿ
)
```

#### å‘Šè­¦é˜ˆå€¼é…ç½®
```bash
# å‘Šè­¦è§„åˆ™
ALERT_THRESHOLDS=(
    "reality_rotation_failure:1"           # è½®æ¢å¤±è´¥ç«‹å³å‘Šè­¦
    "sni_selection_timeout:30s"            # SNIé€‰æ‹©è¶…æ—¶30ç§’
    "connection_success_rate:0.95"         # è¿æ¥æˆåŠŸç‡ä½äº95%
    "config_update_duration:300s"          # é…ç½®æ›´æ–°è¶…è¿‡5åˆ†é’Ÿ
    "service_restart_failure:1"            # æœåŠ¡é‡å¯å¤±è´¥
)
```

### æ—¥å¿—ç®¡ç†ç­–ç•¥

#### æ—¥å¿—çº§åˆ«ä¸å†…å®¹
```bash
# æ—¥å¿—çº§åˆ«å®šä¹‰
LOG_LEVEL_DEBUG=0    # è°ƒè¯•ä¿¡æ¯: è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
LOG_LEVEL_INFO=1     # ä¸€èˆ¬ä¿¡æ¯: æ­£å¸¸æ“ä½œè®°å½•
LOG_LEVEL_WARN=2     # è­¦å‘Šä¿¡æ¯: å¼‚å¸¸ä½†å¯ç»§ç»­
LOG_LEVEL_ERROR=3    # é”™è¯¯ä¿¡æ¯: éœ€è¦å¤„ç†çš„é—®é¢˜
LOG_LEVEL_CRITICAL=4 # ä¸¥é‡é”™è¯¯: ç³»ç»Ÿæ•…éšœ

# æ—¥å¿—å†…å®¹è§„èŒƒ
log_format() {
    local level="$1"
    local component="$2" 
    local message="$3"
    local timestamp=$(date -Iseconds)
    
    echo "[$timestamp][$level][$component] $message"
}
```

#### æ—¥å¿—è½®è½¬é…ç½®
```bash
# logrotateé…ç½®: /etc/logrotate.d/edgebox-security
/var/log/edgebox/security/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
    postrotate
        /usr/local/bin/edgeboxctl system reload-logging
    endscript
}

# æ•æ„Ÿæ—¥å¿—å¤„ç†
cleanup_sensitive_logs() {
    # è‡ªåŠ¨æ¸…ç†åŒ…å«å¯†é’¥ä¿¡æ¯çš„æ—¥å¿—
    sed -i '/private_key\|public_key\|password/d' /var/log/edgebox/security/*.log
    
    # åŠ å¯†å¤‡ä»½é‡è¦æ—¥å¿—
    tar -czf "/var/log/edgebox/backup/security-$(date +%Y%m%d).tar.gz" \
        /var/log/edgebox/security/*.log
    
    # æ¸…ç†30å¤©å‰çš„å¤‡ä»½
    find /var/log/edgebox/backup/ -name "security-*.tar.gz" -mtime +30 -delete
}
```

### è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬

#### å¥åº·æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# æ–‡ä»¶: /usr/local/bin/edgebox-health-check.sh

perform_security_health_check() {
    local status="healthy"
    local issues=()
    
    # æ£€æŸ¥Realityå¯†é’¥çŠ¶æ€
    check_reality_key_health() {
        local expires_at=$(jq -r '.reality.current.expires_at' "${CONFIG_DIR}/server.json")
        local expires_timestamp=$(date -d "$expires_at" +%s)
        local current_timestamp=$(date +%s)
        local days_remaining=$(( (expires_timestamp - current_timestamp) / 86400 ))
        
        if [[ $days_remaining -lt 7 ]]; then
            issues+=("Realityå¯†é’¥å°†åœ¨${days_remaining}å¤©åè¿‡æœŸ")
            if [[ $days_remaining -lt 0 ]]; then
                status="critical"
            else
                status="warning"
            fi
        fi
    }
    
    # æ£€æŸ¥SNIåŸŸåçŠ¶æ€
    check_sni_domain_health() {
        local current_sni=$(jq -r '.inbounds[] | select(.tag | contains("reality")) | .streamSettings.realitySettings.dest' "${CONFIG_DIR}/xray.json" | head -1 | cut -d: -f1)
        
        if ! curl -s --connect-timeout 5 "https://${current_sni}" >/dev/null 2>&1; then
            issues+=("å½“å‰SNIåŸŸå ${current_sni} ä¸å¯è¾¾")
            status="warning"
        fi
    }
    
    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    check_service_health() {
        local services=("xray" "sing-box" "nginx")
        for service in "${services[@]}"; do
            if ! systemctl is-active --quiet "$service"; then
                issues+=("æœåŠ¡ ${service} æœªè¿è¡Œ")
                status="critical"
            fi
        done
    }
    
    # æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥
    check_reality_key_health
    check_sni_domain_health  
    check_service_health
    
    # ç”ŸæˆæŠ¥å‘Š
    generate_health_report "$status" "${issues[@]}"
}

generate_health_report() {
    local status="$1"
    shift
    local issues=("$@")
    
    local report_file="/tmp/edgebox-health-$(date +%Y%m%d-%H%M%S).json"
    
    jq -n \
        --arg status "$status" \
        --arg timestamp "$(date -Iseconds)" \
        --argjson issues "$(printf '%s\n' "${issues[@]}" | jq -R . | jq -s .)" \
        '{
            "status": $status,
            "timestamp": $timestamp,
            "issues": $issues,
            "summary": {
                "total_issues": ($issues | length),
                "critical_count": ($issues | map(select(contains("critical"))) | length),
                "warning_count": ($issues | map(select(contains("warning"))) | length)
            }
        }' > "$report_file"
    
    # æ ¹æ®çŠ¶æ€å‘é€é€šçŸ¥
    case "$status" in
        "critical")
            send_alert "critical" "EdgeBoxå®‰å…¨å¥åº·æ£€æŸ¥å‘ç°ä¸¥é‡é—®é¢˜: $(IFS=', '; echo "${issues[*]}")"
            ;;
        "warning")
            send_notification "warning" "EdgeBoxå®‰å…¨å¥åº·æ£€æŸ¥å‘ç°è­¦å‘Š: $(IFS=', '; echo "${issues[*]}")"
            ;;
        "healthy")
            log_info "EdgeBoxå®‰å…¨å¥åº·æ£€æŸ¥: ç³»ç»Ÿè¿è¡Œæ­£å¸¸"
            ;;
    esac
    
    echo "$report_file"
}
```

#### è‡ªåŠ¨æ¢å¤è„šæœ¬
```bash
#!/bin/bash
# æ–‡ä»¶: /usr/local/bin/edgebox-auto-recovery.sh

auto_recovery_system() {
    log_info "å¼€å§‹è‡ªåŠ¨æ¢å¤æ£€æŸ¥..."
    
    # æ£€æŸ¥å¹¶æ¢å¤å…³é”®æœåŠ¡
    recover_critical_services() {
        local services=("xray" "sing-box" "nginx")
        local recovered_services=()
        
        for service in "${services[@]}"; do
            if ! systemctl is-active --quiet "$service"; then
                log_warn "æ£€æµ‹åˆ°æœåŠ¡ $service æœªè¿è¡Œï¼Œå°è¯•é‡å¯..."
                
                if systemctl restart "$service"; then
                    log_success "æœåŠ¡ $service é‡å¯æˆåŠŸ"
                    recovered_services+=("$service")
                else
                    log_error "æœåŠ¡ $service é‡å¯å¤±è´¥"
                    attempt_service_recovery "$service"
                fi
            fi
        done
        
        if [[ ${#recovered_services[@]} -gt 0 ]]; then
            send_notification "info" "è‡ªåŠ¨æ¢å¤æœåŠ¡: ${recovered_services[*]}"
        fi
    }
    
    # æ£€æŸ¥å¹¶ä¿®å¤é…ç½®æ–‡ä»¶
    recover_config_files() {
        local config_files=(
            "${CONFIG_DIR}/xray.json"
            "${CONFIG_DIR}/sing-box.json"
            "/etc/nginx/nginx.conf"
        )
        
        for config_file in "${config_files[@]}"; do
            if [[ ! -f "$config_file" ]] || ! validate_config_file "$config_file"; then
                log_warn "é…ç½®æ–‡ä»¶ $config_file å¼‚å¸¸ï¼Œå°è¯•æ¢å¤..."
                restore_config_backup "$config_file"
            fi
        done
    }
    
    # æ£€æŸ¥å¹¶ä¿®å¤ç½‘ç»œè¿æ¥
    recover_network_connectivity() {
        # æµ‹è¯•å…³é”®è¿æ¥
        local test_targets=("8.8.8.8" "1.1.1.1" "www.cloudflare.com")
        local connectivity_ok=false
        
        for target in "${test_targets[@]}"; do
            if ping -c 1 -W 3 "$target" >/dev/null 2>&1; then
                connectivity_ok=true
                break
            fi
        done
        
        if [[ "$connectivity_ok" == "false" ]]; then
            log_error "ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œå°è¯•é‡å¯ç½‘ç»œæœåŠ¡..."
            systemctl restart networking
            sleep 5
            
            # é‡æ–°æµ‹è¯•
            if ping -c 1 -W 3 "8.8.8.8" >/dev/null 2>&1; then
                log_success "ç½‘ç»œè¿æ¥å·²æ¢å¤"
                send_notification "info" "ç½‘ç»œè¿æ¥è‡ªåŠ¨æ¢å¤æˆåŠŸ"
            else
                log_critical "ç½‘ç»œè¿æ¥æ¢å¤å¤±è´¥"
                send_alert "critical" "ç½‘ç»œè¿æ¥æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„"
            fi
        fi
    }
    
    # æ‰§è¡Œæ¢å¤æµç¨‹
    recover_critical_services
    recover_config_files
    recover_network_connectivity
    
    log_info "è‡ªåŠ¨æ¢å¤æ£€æŸ¥å®Œæˆ"
}

# é«˜çº§æœåŠ¡æ¢å¤
attempt_service_recovery() {
    local service="$1"
    
    case "$service" in
        "xray")
            # æ£€æŸ¥é…ç½®æ–‡ä»¶
            if ! jq '.' "${CONFIG_DIR}/xray.json" >/dev/null 2>&1; then
                log_error "Xrayé…ç½®æ–‡ä»¶JSONæ ¼å¼é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½é…ç½®"
                restore_config_backup "${CONFIG_DIR}/xray.json"
            fi
            
            # æ£€æŸ¥ç«¯å£å ç”¨
            if ss -tlnp | grep -q ":11443"; then
                log_warn "ç«¯å£11443è¢«å ç”¨ï¼Œå°è¯•æ¸…ç†"
                fuser -k 11443/tcp 2>/dev/null || true
                sleep 2
            fi
            ;;
            
        "sing-box")
            # æ£€æŸ¥é…ç½®æ–‡ä»¶
            if ! jq '.' "${CONFIG_DIR}/sing-box.json" >/dev/null 2>&1; then
                log_error "sing-boxé…ç½®æ–‡ä»¶JSONæ ¼å¼é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½é…ç½®"
                restore_config_backup "${CONFIG_DIR}/sing-box.json"
            fi
            
            # æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
            if [[ ! -f "${CERT_DIR}/current.pem" ]] || [[ ! -f "${CERT_DIR}/current.key" ]]; then
                log_error "è¯ä¹¦æ–‡ä»¶ç¼ºå¤±ï¼Œé‡æ–°ç”Ÿæˆè‡ªç­¾åè¯ä¹¦"
                generate_self_signed_cert
            fi
            ;;
            
        "nginx")
            # æµ‹è¯•é…ç½®æ–‡ä»¶
            if ! nginx -t >/dev/null 2>&1; then
                log_error "Nginxé…ç½®æ–‡ä»¶é”™è¯¯ï¼Œæ¢å¤é»˜è®¤é…ç½®"
                restore_config_backup "/etc/nginx/nginx.conf"
            fi
            ;;
    esac
    
    # é‡æ–°å°è¯•å¯åŠ¨æœåŠ¡
    sleep 3
    if systemctl restart "$service"; then
        log_success "æœåŠ¡ $service æ¢å¤æˆåŠŸ"
        return 0
    else
        log_critical "æœåŠ¡ $service æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„"
        return 1
    fi
}
```

---

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### Problem 1: Realityå¯†é’¥è½®æ¢å¤±è´¥
```bash
# ç—‡çŠ¶: å¯†é’¥è½®æ¢å‘½ä»¤æ‰§è¡Œå¤±è´¥
# åŸå› åˆ†æ:
# 1. sing-boxæœªæ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬è¿‡ä½
# 2. ç£ç›˜ç©ºé—´ä¸è¶³
# 3. é…ç½®æ–‡ä»¶æƒé™é—®é¢˜

# è¯Šæ–­å‘½ä»¤:
edgeboxctl security reality status
sing-box version
df -h /etc/edgebox
ls -la "${CONFIG_DIR}/xray.json"

# è§£å†³æ–¹æ¡ˆ:
# 1. é‡æ–°å®‰è£…sing-box
curl -fsSL https://sing-box.sagernet.org/install.sh | bash

# 2. æ¸…ç†ç£ç›˜ç©ºé—´
find /var/log -name "*.log" -mtime +7 -delete
apt autoremove && apt autoclean

# 3. ä¿®å¤æ–‡ä»¶æƒé™
chown -R root:root /etc/edgebox
chmod 644 "${CONFIG_DIR}"/*.json
```

#### Problem 2: SNIåŸŸåé€‰æ‹©å¼‚å¸¸
```bash
# ç—‡çŠ¶: SNIåŸŸåå§‹ç»ˆé€‰æ‹©å¤±è´¥æˆ–é€‰æ‹©ä¸å½“
# åŸå› åˆ†æ:
# 1. ç½‘ç»œè¿æ¥é—®é¢˜
# 2. åŸŸåæ± é…ç½®é”™è¯¯
# 3. è¯„åˆ†ç®—æ³•å¼‚å¸¸

# è¯Šæ–­å‘½ä»¤:
edgeboxctl sni test-all
curl -I https://www.microsoft.com
nslookup www.microsoft.com

# è§£å†³æ–¹æ¡ˆ:
# 1. æ‰‹åŠ¨æŒ‡å®šSNIåŸŸå
edgeboxctl sni set www.cloudflare.com

# 2. é‡ç½®åŸŸåæ± 
edgeboxctl sni reset-pool

# 3. æ›´æ–°DNSè®¾ç½®
echo "nameserver 8.8.8.8" > /etc/resolv.conf
echo "nameserver 1.1.1.1" >> /etc/resolv.conf
```

#### Problem 3: æµé‡éšæœºåŒ–å¯¼è‡´è¿æ¥é—®é¢˜
```bash
# ç—‡çŠ¶: éšæœºåŒ–åå®¢æˆ·ç«¯è¿æ¥ä¸ç¨³å®š
# åŸå› åˆ†æ:
# 1. éšæœºå‚æ•°è¶…å‡ºå®¢æˆ·ç«¯æ”¯æŒèŒƒå›´
# 2. ç½‘ç»œç¯å¢ƒå¯¹æŸäº›å‚æ•°æ•æ„Ÿ
# 3. å‚æ•°ç»„åˆä¸å…¼å®¹

# è¯Šæ–­å‘½ä»¤:
edgeboxctl traffic status
systemctl status sing-box
journalctl -u sing-box -f

# è§£å†³æ–¹æ¡ˆ:
# 1. é‡ç½®ä¸ºé»˜è®¤å‚æ•°
edgeboxctl traffic reset-defaults

# 2. ç¦ç”¨éšæœºåŒ–
edgeboxctl traffic randomize --disable

# 3. é€æ­¥å¯ç”¨éšæœºåŒ–
edgeboxctl traffic randomize --level=light
```

### ç´§æ€¥æ¢å¤ç¨‹åº

#### å®Œå…¨ç³»ç»Ÿé‡ç½®
```bash
#!/bin/bash
# ç´§æ€¥æ¢å¤è„šæœ¬: emergency-reset.sh

emergency_reset() {
    log_critical "æ‰§è¡Œç´§æ€¥ç³»ç»Ÿé‡ç½®..."
    
    # 1. åœæ­¢æ‰€æœ‰æœåŠ¡
    systemctl stop xray sing-box nginx
    
    # 2. å¤‡ä»½å½“å‰é…ç½®
    backup_dir="/root/emergency-backup-$(date +%Y%m%d-%H%M%S)"
    mkdir -p "$backup_dir"
    cp -r /etc/edgebox "$backup_dir/"
    
    # 3. æ¢å¤åˆ°å·²çŸ¥è‰¯å¥½çŠ¶æ€
    if [[ -f "/etc/edgebox/backup/last-known-good.tar.gz" ]]; then
        cd /etc/edgebox
        tar -xzf backup/last-known-good.tar.gz
        log_info "å·²æ¢å¤åˆ°æœ€åå·²çŸ¥è‰¯å¥½é…ç½®"
    else
        log_warn "æœªæ‰¾åˆ°å¤‡ä»½é…ç½®ï¼Œå°†é‡æ–°åˆå§‹åŒ–"
        regenerate_all_configs
    fi
    
    # 4. é‡æ–°ç”Ÿæˆå…³é”®å¯†é’¥
    generate_reality_keys
    generate_all_uuids
    generate_passwords
    
    # 5. æ›´æ–°é…ç½®æ–‡ä»¶
    configure_xray
    configure_sing_box
    configure_nginx
    
    # 6. é‡å¯æœåŠ¡
    systemctl start nginx xray sing-box
    
    # 7. éªŒè¯ç³»ç»ŸçŠ¶æ€
    sleep 10
    if verify_all_services; then
        log_success "ç´§æ€¥æ¢å¤å®Œæˆï¼Œç³»ç»Ÿæ­£å¸¸è¿è¡Œ"
        send_notification "success" "EdgeBoxç´§æ€¥æ¢å¤æˆåŠŸ"
    else
        log_critical "ç´§æ€¥æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„"
        send_alert "critical" "EdgeBoxç´§æ€¥æ¢å¤å¤±è´¥"
    fi
}
```

---

## å®‰å…¨æœ€ä½³å®è·µ

### éƒ¨ç½²å‰å®‰å…¨æ£€æŸ¥æ¸…å•

#### ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥
- [ ] **æ“ä½œç³»ç»Ÿç‰ˆæœ¬**: Ubuntu 20.04+ æˆ– Debian 11+
- [ ] **ç³»ç»Ÿå®‰å…¨æ›´æ–°**: å·²å®‰è£…æœ€æ–°å®‰å…¨è¡¥ä¸
- [ ] **é˜²ç«å¢™é…ç½®**: ä»…å¼€æ”¾å¿…è¦ç«¯å£(80, 443, 2053)
- [ ] **SSHè®¿é—®æ§åˆ¶**: ç¦ç”¨å¯†ç ç™»å½•ï¼Œä½¿ç”¨å¯†é’¥è®¤è¯
- [ ] **ç”¨æˆ·æƒé™ç®¡ç†**: éµå¾ªæœ€å°æƒé™åŸåˆ™
- [ ] **æ—¶é—´åŒæ­¥**: é…ç½®NTPç¡®ä¿æ—¶é—´å‡†ç¡®

#### ç½‘ç»œç¯å¢ƒè¯„ä¼°
- [ ] **IPä¿¡èª‰æ£€æŸ¥**: ç¡®è®¤æœåŠ¡å™¨IPæœªè¢«åˆ—å…¥é»‘åå•
- [ ] **åœ°ç†ä½ç½®**: é€‰æ‹©ç½‘ç»œå‹å¥½çš„åœ°åŒºéƒ¨ç½²
- [ ] **ISPç”»åƒ**: é¿å…è¢«å¤§é‡åŒç±»ç”¨é€”ä½¿ç”¨çš„ASN
- [ ] **å¸¦å®½è´¨é‡**: ç¡®ä¿ä¸Šä¸‹è¡Œå¸¦å®½å……è¶³ä¸”ç¨³å®š
- [ ] **å»¶è¿Ÿæµ‹è¯•**: åˆ°ä¸»è¦åœ°åŒºå»¶è¿Ÿåœ¨åˆç†èŒƒå›´å†…

#### é…ç½®å®‰å…¨éªŒè¯
- [ ] **å¯†é’¥å¼ºåº¦**: æ‰€æœ‰å¯†é’¥ä½¿ç”¨å¼ºéšæœºç”Ÿæˆ
- [ ] **è¯ä¹¦æœ‰æ•ˆæ€§**: TLSè¯ä¹¦é…ç½®æ­£ç¡®ä¸”æœªè¿‡æœŸ
- [ ] **åè®®å‚æ•°**: å„åè®®å‚æ•°è®¾ç½®åˆç†
- [ ] **æ—¥å¿—å®‰å…¨**: æ•æ„Ÿä¿¡æ¯ä¸å‡ºç°åœ¨æ—¥å¿—ä¸­
- [ ] **å¤‡ä»½åŠ å¯†**: é…ç½®å¤‡ä»½ä½¿ç”¨åŠ å¯†å­˜å‚¨

### è¿è¡Œæ—¶å®‰å…¨ç›‘æ§

#### å®æ—¶ç›‘æ§æŒ‡æ ‡
```bash
# å…³é”®å®‰å…¨æŒ‡æ ‡ç›‘æ§
SECURITY_METRICS=(
    "failed_connection_rate"        # å¤±è´¥è¿æ¥ç‡
    "unusual_traffic_pattern"       # å¼‚å¸¸æµé‡æ¨¡å¼
    "repeated_probe_attempts"       # é‡å¤æ¢æµ‹å°è¯•
    "cert_expiration_warning"       # è¯ä¹¦è¿‡æœŸé¢„è­¦
    "key_rotation_overdue"          # å¯†é’¥è½®æ¢è¶…æœŸ
    "config_integrity_check"        # é…ç½®å®Œæ•´æ€§æ£€æŸ¥
    "service_availability"          # æœåŠ¡å¯ç”¨æ€§
)

# å¼‚å¸¸æ£€æµ‹é˜ˆå€¼
ANOMALY_THRESHOLDS=(
    "connection_failure_rate>0.1"   # è¿æ¥å¤±è´¥ç‡>10%
    "probe_attempts>100/hour"       # æ¢æµ‹>100æ¬¡/å°æ—¶
    "cert_expires<7days"            # è¯ä¹¦7å¤©å†…è¿‡æœŸ
    "key_age>90days"                # å¯†é’¥ä½¿ç”¨>90å¤©
    "config_changes>5/day"          # é…ç½®å˜æ›´>5æ¬¡/å¤©
)
```

#### è‡ªåŠ¨å“åº”ç­–ç•¥
```bash
# å¼‚å¸¸å“åº”è‡ªåŠ¨åŒ–
respond_to_anomaly() {
    local anomaly_type="$1"
    local severity="$2"
    local details="$3"
    
    case "$anomaly_type" in
        "excessive_probes")
            # æ£€æµ‹åˆ°å¤§é‡æ¢æµ‹æ—¶çš„å“åº”
            enable_rate_limiting
            update_firewall_rules
            rotate_sni_domain_immediately
            ;;
            
        "connection_failures")
            # è¿æ¥å¤±è´¥ç‡è¿‡é«˜æ—¶çš„å“åº”
            check_service_health
            test_all_protocols
            send_diagnostic_report
            ;;
            
        "cert_expiration")
            # è¯ä¹¦å³å°†è¿‡æœŸæ—¶çš„å“åº”
            request_cert_renewal
            prepare_fallback_cert
            notify_administrators
            ;;
            
        "key_rotation_overdue")
            # å¯†é’¥è½®æ¢è¶…æœŸæ—¶çš„å“åº”
            schedule_emergency_rotation
            audit_key_usage
            update_rotation_policy
            ;;
    esac
    
    # è®°å½•å“åº”è¡Œä¸º
    log_security_response "$anomaly_type" "$severity" "$details"
}
```

### éšç§ä¿æŠ¤æªæ–½

#### æ•°æ®æœ€å°åŒ–åŸåˆ™
```bash
# æ•æ„Ÿæ•°æ®å¤„ç†ç­–ç•¥
SENSITIVE_DATA_HANDLING=(
    "connection_logs:7days"         # è¿æ¥æ—¥å¿—ä¿ç•™7å¤©
    "error_logs:30days"             # é”™è¯¯æ—¥å¿—ä¿ç•™30å¤©
    "rotation_logs:90days"          # è½®æ¢æ—¥å¿—ä¿ç•™90å¤©
    "ip_addresses:no_log"           # ä¸è®°å½•å®¢æˆ·ç«¯IP
    "traffic_content:no_inspect"    # ä¸æ£€æŸ¥æµé‡å†…å®¹
    "user_agents:anonymize"         # ç”¨æˆ·ä»£ç†åŒ¿ååŒ–
)

# è‡ªåŠ¨æ•°æ®æ¸…ç†
auto_cleanup_sensitive_data() {
    # æ¸…ç†è¿‡æœŸæ—¥å¿—
    find /var/log/edgebox -name "*.log" -mtime +7 -exec shred -vfz -n 3 {} \;
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    find /tmp -name "*edgebox*" -mtime +1 -delete
    
    # æ¸…ç†å†å²å‘½ä»¤
    history -c && history -w
    
    # æ¸…ç†ç³»ç»Ÿæ—¥å¿—ä¸­çš„æ•æ„Ÿä¿¡æ¯
    journalctl --vacuum-time=7d
    
    log_info "æ•æ„Ÿæ•°æ®è‡ªåŠ¨æ¸…ç†å®Œæˆ"
}
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç³»ç»Ÿçº§ä¼˜åŒ–

#### å†…æ ¸å‚æ•°è°ƒä¼˜
```bash
# /etc/sysctl.d/99-edgebox-security.conf
# ç½‘ç»œæ€§èƒ½ä¼˜åŒ–
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
net.ipv4.tcp_rmem = 4096 65536 134217728
net.ipv4.tcp_wmem = 4096 65536 134217728
net.ipv4.tcp_congestion_control = bbr

# è¿æ¥è·Ÿè¸ªä¼˜åŒ–
net.netfilter.nf_conntrack_max = 1048576
net.netfilter.nf_conntrack_tcp_timeout_established = 7200

# æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
fs.file-max = 1048576
```

#### æœåŠ¡èµ„æºé™åˆ¶
```bash
# systemdæœåŠ¡èµ„æºé™åˆ¶ä¼˜åŒ–
# /etc/systemd/system/xray.service.d/override.conf
[Service]
LimitNOFILE=1048576
LimitNPROC=1048576
CPUQuota=200%
MemoryLimit=2G

# /etc/systemd/system/sing-box.service.d/override.conf  
[Service]
LimitNOFILE=1048576
LimitNPROC=1048576
CPUQuota=150%
MemoryLimit=1G
```

### åº”ç”¨çº§ä¼˜åŒ–

#### é…ç½®æ–‡ä»¶ä¼˜åŒ–
```json
# Xrayä¼˜åŒ–é…ç½®ç¤ºä¾‹
{
  "policy": {
    "handshake": 4,
    "connIdle": 300,
    "uplinkOnly": 2,
    "downlinkOnly": 5,
    "bufferSize": 64
  },
  "stats": {},
  "api": {
    "tag": "api",
    "services": ["StatsService"]
  }
}
```

#### è¯ä¹¦ç®¡ç†ä¼˜åŒ–
```bash
# è¯ä¹¦é¢„åŠ è½½ä¼˜åŒ–
preload_certificates() {
    # é¢„ç”Ÿæˆå¤šä¸ªè¯ä¹¦
    for i in {1..3}; do
        generate_backup_cert "$i"
    done
    
    # è¯ä¹¦é“¾ä¼˜åŒ–
    optimize_cert_chain
    
    # OCSPè£…è®¢å¯ç”¨
    enable_ocsp_stapling
}
```

---

## ç»“è®ºä¸å±•æœ›

### å®æ–½æˆæœé¢„æœŸ

é€šè¿‡æœ¬æŠ€æœ¯æ–‡æ¡£æŒ‡å¯¼çš„å®‰å…¨æ”¹è¿›å®æ–½ï¼ŒEdgeBoxé¢„æœŸè¾¾åˆ°ä»¥ä¸‹æ•ˆæœï¼š

#### å®‰å…¨æ€§æå‡
- **å¯†é’¥ç®¡ç†**: Realityå¯†é’¥90å¤©è‡ªåŠ¨è½®æ¢ï¼Œé™ä½é•¿æœŸæš´éœ²é£é™©
- **æµé‡ä¼ªè£…**: SNIåŸŸåæ™ºèƒ½è½®æ¢ï¼Œé¿å…å›ºå®šç›®æ ‡è¢«é’ˆå¯¹
- **è¡Œä¸ºå¤šæ ·åŒ–**: åè®®å‚æ•°éšæœºåŒ–ï¼Œé™ä½æµé‡æŒ‡çº¹è¯†åˆ«æ¦‚ç‡
- **è¿ç»´å®‰å…¨**: è‡ªåŠ¨åŒ–ç®¡ç†å‡å°‘äººä¸ºæ“ä½œç—•è¿¹

#### å¯é æ€§å¢å¼º
- **æ•…éšœè‡ªæ„ˆ**: è‡ªåŠ¨æ£€æµ‹ä¸æ¢å¤æœºåˆ¶ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§
- **å¤šé‡å¤‡ç”¨**: å¤šåè®®ä¿éšœï¼Œå•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“å¯ç”¨æ€§
- **å¹³æ»‘å‡çº§**: é…ç½®å˜æ›´å¯¹ç”¨æˆ·é€æ˜ï¼Œä¸šåŠ¡è¿ç»­æ€§ä¿éšœ
- **ç›‘æ§å‘Šè­¦**: å®æ—¶çŠ¶æ€ç›‘æ§ï¼Œé—®é¢˜åŠæ—¶å‘ç°å¤„ç†

#### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **æ— æ„ŸçŸ¥æ›´æ–°**: SNIå’Œæµé‡ä¼˜åŒ–å®Œå…¨åå°è¿›è¡Œ
- **æ™ºèƒ½é€‚é…**: æ ¹æ®ç½‘ç»œç¯å¢ƒè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å‚æ•°
- **ä¾¿æ·ç®¡ç†**: ç»Ÿä¸€çš„edgeboxctlå‘½ä»¤è¡Œå·¥å…·
- **æ¸…æ™°é€šçŸ¥**: åŠæ—¶å‡†ç¡®çš„çŠ¶æ€é€šçŸ¥å’Œæ“ä½œæŒ‡å¯¼

### æœªæ¥å‘å±•æ–¹å‘

#### çŸ­æœŸè§„åˆ’ (3-6ä¸ªæœˆ)
- **AIé©±åŠ¨ä¼˜åŒ–**: åŸºäºæœºå™¨å­¦ä¹ çš„å‚æ•°è‡ªé€‚åº”è°ƒæ•´
- **åœ°ç†ä½ç½®æ„ŸçŸ¥**: æ ¹æ®ç”¨æˆ·åœ°ç†ä½ç½®ä¼˜åŒ–åè®®é€‰æ‹©
- **æµé‡åˆ†æå¯¹æŠ—**: æ›´é«˜çº§çš„æµé‡æ¨¡å¼ä¼ªè£…æŠ€æœ¯
- **ç§»åŠ¨ç«¯æ”¯æŒ**: é’ˆå¯¹ç§»åŠ¨ç½‘ç»œç¯å¢ƒçš„ç‰¹æ®Šä¼˜åŒ–

#### ä¸­æœŸè§„åˆ’ (6-12ä¸ªæœˆ)
- **åˆ†å¸ƒå¼éƒ¨ç½²**: å¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡ä¸æ•…éšœè½¬ç§»
- **æ™ºèƒ½è·¯ç”±**: åŸºäºç½‘ç»œè´¨é‡çš„åŠ¨æ€è·¯ç”±é€‰æ‹©
- **éšç§å¢å¼º**: é›¶æ—¥å¿—æ¶æ„ä¸ç«¯åˆ°ç«¯åŠ å¯†
- **åˆè§„æ”¯æŒ**: é€‚åº”ä¸åŒåœ°åŒºçš„æ³•è§„è¦æ±‚

#### é•¿æœŸæ„¿æ™¯ (1å¹´ä»¥ä¸Š)
- **åè®®åˆ›æ–°**: å‚ä¸ä¸‹ä¸€ä»£éšç§åè®®æ ‡å‡†åˆ¶å®š
- **ç”Ÿæ€é›†æˆ**: ä¸å…¶ä»–éšç§å·¥å…·çš„æ·±åº¦é›†æˆ
- **å¼€æºè´¡çŒ®**: å‘å¼€æºç¤¾åŒºè´¡çŒ®æ ¸å¿ƒæŠ€æœ¯
- **å®‰å…¨ç ”ç©¶**: æŒç»­çš„å®‰å…¨ç ”ç©¶ä¸æ¼æ´å‘ç°

### æŠ€æœ¯å€ºåŠ¡ç®¡ç†

#### ä»£ç è´¨é‡æå‡
- **å•å…ƒæµ‹è¯•è¦†ç›–**: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°90%ä»¥ä¸Š
- **ä»£ç è§„èŒƒ**: ç»Ÿä¸€çš„Shellè„šæœ¬ç¼–ç è§„èŒƒä¸è‡ªåŠ¨æ£€æŸ¥
- **æ–‡æ¡£åŒæ­¥**: ä»£ç å˜æ›´ä¸æ–‡æ¡£çš„åŒæ­¥æ›´æ–°æœºåˆ¶
- **ç‰ˆæœ¬ç®¡ç†**: è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ä¸å‘å¸ƒæµç¨‹

#### æ¶æ„é‡æ„
- **æ¨¡å—åŒ–è®¾è®¡**: è¿›ä¸€æ­¥æ‹†åˆ†åŠŸèƒ½æ¨¡å—ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- **é…ç½®ä¸­å¿ƒ**: ç»Ÿä¸€çš„é…ç½®ç®¡ç†ä¸åˆ†å‘æœºåˆ¶
- **æ’ä»¶æ¶æ„**: æ”¯æŒç¬¬ä¸‰æ–¹åŠŸèƒ½æ‰©å±•çš„æ’ä»¶ç³»ç»Ÿ
- **äº‘åŸç”Ÿ**: å®¹å™¨åŒ–éƒ¨ç½²ä¸Kubernetesé›†æˆ

---

## é™„å½•

### A. å‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# Realityå¯†é’¥ç®¡ç†
edgeboxctl security reality rotate [--force]
edgeboxctl security reality status
edgeboxctl security reality schedule --enable
edgeboxctl security reality history --limit=10

# SNIåŸŸåç®¡ç†
edgeboxctl sni pool list
edgeboxctl sni test-all
edgeboxctl sni set <domain>
edgeboxctl sni auto-select

# æµé‡éšæœºåŒ–
edgeboxctl traffic randomize --level=[light|medium|heavy]
edgeboxctl traffic status
edgeboxctl traffic reset-defaults

# ç³»ç»Ÿç›‘æ§
edgeboxctl system health-check
edgeboxctl system auto-recovery
edgeboxctl system backup --encrypt
edgeboxctl system restore <backup-file>

# æ—¥å¿—ç®¡ç†
edgeboxctl logs security --tail=100
edgeboxctl logs rotation --since="2025-01-01"
edgeboxctl logs cleanup --older-than=30d
```

### B. é…ç½®æ–‡ä»¶æ¨¡æ¿

#### security.confå®Œæ•´é…ç½®
```ini
# EdgeBoxå®‰å…¨é…ç½®æ–‡ä»¶
# ä½ç½®: /etc/edgebox/security/config/security.conf

[reality]
rotation_enabled=true
rotation_days=90
notification_days=7
backup_count=5
auto_schedule=true
emergency_rotation_threshold=0.95

[sni]
pool_enabled=true
rotation_frequency=weekly
health_check_interval=3600
failure_threshold=3
auto_fallback=true

[traffic]
randomization_enabled=true
light_schedule="0 4 * * *"
medium_schedule="0 5 * * 0"
heavy_schedule="0 6 1 * *"
performance_priority=high

[monitoring]
health_check_interval=300
anomaly_detection=true
auto_response=true
alert_threshold=warning

[notification]
email_enabled=false
webhook_enabled=false
dashboard_enabled=true
log_level=info

[backup]
auto_backup=true
backup_interval=daily
encryption_enabled=true
retention_days=30
```

### C. æ•…éšœæ’é™¤å†³ç­–æ ‘

```mermaid
graph TD
    A[å‘ç°é—®é¢˜] --> B{æœåŠ¡çŠ¶æ€æ£€æŸ¥}
    B -->|æ­£å¸¸| C{é…ç½®æ–‡ä»¶æ£€æŸ¥}
    B -->|å¼‚å¸¸| D[é‡å¯æœåŠ¡]
    
    C -->|æ­£å¸¸| E{ç½‘ç»œè¿æ¥æ£€æŸ¥}
    C -->|å¼‚å¸¸| F[æ¢å¤é…ç½®å¤‡ä»½]
    
    D -->|æˆåŠŸ| G[é—®é¢˜è§£å†³]
    D -->|å¤±è´¥| H[æ£€æŸ¥ç³»ç»Ÿèµ„æº]
    
    E -->|æ­£å¸¸| I{è¯ä¹¦æœ‰æ•ˆæ€§æ£€æŸ¥}
    E -->|å¼‚å¸¸| J[ä¿®å¤ç½‘ç»œé…ç½®]
    
    F --> K[é‡å¯ç›¸å…³æœåŠ¡]
    H --> L[æ¸…ç†èµ„æº/é‡å¯ç³»ç»Ÿ]
    I -->|è¿‡æœŸ| M[æ›´æ–°è¯ä¹¦]
    I -->|æ­£å¸¸| N[æ·±åº¦è¯Šæ–­]
    
    G --> O[è®°å½•è§£å†³æ–¹æ¡ˆ]
    J --> K
    K --> G
    L --> G
    M --> G
    N --> P[è”ç³»æŠ€æœ¯æ”¯æŒ]
```

### D. å®‰å…¨æ£€æŸ¥æ¸…å•

#### éƒ¨ç½²å‰æ£€æŸ¥ âœ“
- [ ] ç³»ç»Ÿæ›´æ–°ä¸å®‰å…¨è¡¥ä¸
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®
- [ ] SSHå¯†é’¥è®¤è¯è®¾ç½®
- [ ] æ—¶é—´åŒæ­¥é…ç½®
- [ ] ç£ç›˜ç©ºé—´æ£€æŸ¥
- [ ] ç½‘ç»œè¿é€šæ€§æµ‹è¯•
- [ ] DNSè§£æéªŒè¯
- [ ] è¯ä¹¦æœ‰æ•ˆæ€§ç¡®è®¤

#### è¿è¡Œæ—¶æ£€æŸ¥ âœ“
- [ ] æœåŠ¡çŠ¶æ€ç›‘æ§
- [ ] é…ç½®æ–‡ä»¶å®Œæ•´æ€§
- [ ] å¯†é’¥è½®æ¢çŠ¶æ€
- [ ] æ—¥å¿—å¼‚å¸¸ç›‘æ§
- [ ] æ€§èƒ½æŒ‡æ ‡æ£€æŸ¥
- [ ] å¤‡ä»½å®Œæ•´æ€§éªŒè¯
- [ ] å®‰å…¨äº‹ä»¶å®¡è®¡
- [ ] ç”¨æˆ·è¿æ¥è´¨é‡

#### ç»´æŠ¤æ£€æŸ¥ âœ“
- [ ] ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡
- [ ] æ—¥å¿—æ–‡ä»¶æ¸…ç†
- [ ] å¤‡ä»½æ–‡ä»¶ç®¡ç†
- [ ] è¯ä¹¦åˆ°æœŸæé†’
- [ ] é…ç½®å˜æ›´è®°å½•
- [ ] å®‰å…¨æ›´æ–°åº”ç”¨
- [ ] æ€§èƒ½ä¼˜åŒ–è¯„ä¼°
- [ ] æ•…éšœæ¢å¤æµ‹è¯•

---

**æ–‡æ¡£ç»´æŠ¤è¯´æ˜**ï¼š
- æœ¬æ–‡æ¡£åº”éšä»£ç å®ç°åŒæ­¥æ›´æ–°
- é‡å¤§å˜æ›´éœ€è¦ç‰ˆæœ¬å·é€’å¢
- å»ºè®®æ¯å­£åº¦è¿›è¡Œå…¨é¢å®¡æŸ¥å’Œæ›´æ–°
- æ‰€æœ‰ä¿®æ”¹éƒ½åº”åœ¨Gitä¸­è·Ÿè¸ªè®°å½•

---

## E. æ€§èƒ½åŸºå‡†æµ‹è¯•

### åŸºå‡†æµ‹è¯•ç¯å¢ƒ
```bash
# æ ‡å‡†æµ‹è¯•ç¯å¢ƒé…ç½®
CPU: 2 vCPU
RAM: 4GB
Disk: 40GB SSD
Network: 1Gbps
OS: Ubuntu 22.04 LTS
```

### æ€§èƒ½æŒ‡æ ‡åŸºå‡†
```bash
# è¿æ¥å»ºç«‹æ—¶é—´
Realityè¿æ¥: < 200ms
Hysteria2è¿æ¥: < 150ms
TUICè¿æ¥: < 180ms

# å¯†é’¥è½®æ¢æ€§èƒ½
è½®æ¢æ‰§è¡Œæ—¶é—´: < 30s
æœåŠ¡ä¸­æ–­æ—¶é—´: < 5s
é…ç½®ç”Ÿæ•ˆæ—¶é—´: < 10s

# SNIåŸŸååˆ‡æ¢
åŸŸåè¯„ä¼°æ—¶é—´: < 5s
é…ç½®æ›´æ–°æ—¶é—´: < 3s
è¿æ¥æ¢å¤æ—¶é—´: < 2s

# æµé‡éšæœºåŒ–
å‚æ•°ç”Ÿæˆæ—¶é—´: < 1s
é…ç½®åº”ç”¨æ—¶é—´: < 5s
æœåŠ¡é‡è½½æ—¶é—´: < 3s
```

### å‹åŠ›æµ‹è¯•åœºæ™¯
```bash
# å¹¶å‘è¿æ¥æµ‹è¯•
æµ‹è¯•å·¥å…·: wrk, ab, curl
å¹¶å‘è¿æ¥æ•°: 1000
æµ‹è¯•æŒç»­æ—¶é—´: 10åˆ†é’Ÿ
é¢„æœŸæˆåŠŸç‡: > 99%

# é•¿æœŸç¨³å®šæ€§æµ‹è¯•
æµ‹è¯•å‘¨æœŸ: 30å¤©
å¯†é’¥è½®æ¢æ¬¡æ•°: 10æ¬¡
SNIåŸŸååˆ‡æ¢: 120æ¬¡
éšæœºåŒ–æ‰§è¡Œ: 900æ¬¡
é¢„æœŸå¯ç”¨æ€§: > 99.9%
```

---

## F. APIæ¥å£æ–‡æ¡£

### edgeboxctl REST API

#### å®‰å…¨ç®¡ç†æ¥å£
```bash
# Realityå¯†é’¥ç®¡ç†
GET /api/v1/security/reality/status
POST /api/v1/security/reality/rotate
GET /api/v1/security/reality/history

# SNIåŸŸåç®¡ç†
GET /api/v1/sni/pool
POST /api/v1/sni/select
GET /api/v1/sni/health

# æµé‡éšæœºåŒ–
POST /api/v1/traffic/randomize
GET /api/v1/traffic/status
POST /api/v1/traffic/reset
```

#### å“åº”æ ¼å¼ç¤ºä¾‹
```json
{
  "status": "success",
  "timestamp": "2025-01-01T12:00:00Z",
  "data": {
    "reality": {
      "current_public_key": "xxx...",
      "expires_at": "2025-04-01T00:00:00Z",
      "days_remaining": 89,
      "auto_rotation": true
    }
  },
  "meta": {
    "version": "3.0.0",
    "request_id": "req_123456"
  }
}
```

---

## G. å®‰å…¨å¨èƒæ¨¡å‹

### å¨èƒåˆ†ç±»ä¸åº”å¯¹

#### è¢«åŠ¨ç›‘å¬å¨èƒ
**å¨èƒæè¿°**: é€šè¿‡æµé‡åˆ†æè¯†åˆ«åè®®ç‰¹å¾
**é£é™©ç­‰çº§**: ä¸­ç­‰
**åº”å¯¹æªæ–½**:
- Realityåè®®ä¼ªè£…HTTPSæµé‡
- SNIåŸŸåå®šæœŸè½®æ¢é¿å…å›ºå®šç›®æ ‡
- æµé‡æ—¶åºå’ŒåŒ…é•¿éšæœºåŒ–
- å¤šåè®®æ··åˆä½¿ç”¨åˆ†æ•£ç‰¹å¾

#### ä¸»åŠ¨æ¢æµ‹å¨èƒ  
**å¨èƒæè¿°**: é€šè¿‡ä¸»åŠ¨è¿æ¥æµ‹è¯•è¯†åˆ«æœåŠ¡
**é£é™©ç­‰çº§**: é«˜
**åº”å¯¹æªæ–½**:
- 443ç«¯å£å®Œæ•´HTTPSä¼ªè£…
- éæ ‡å‡†ç«¯å£éšè”½æ€§å¢å¼º
- æ¢æµ‹æµé‡æ£€æµ‹ä¸é™æµ
- èœœç½æœºåˆ¶è¯¯å¯¼æ”»å‡»è€…

#### é…ç½®æ³„éœ²å¨èƒ
**å¨èƒæè¿°**: é€šè¿‡è·å–é…ç½®æ–‡ä»¶æš´éœ²ä¿¡æ¯
**é£é™©ç­‰çº§**: ä¸¥é‡
**åº”å¯¹æªæ–½**:
- é…ç½®æ–‡ä»¶æƒé™ä¸¥æ ¼æ§åˆ¶
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- å®šæœŸå¯†é’¥è½®æ¢é™ä½å½±å“
- è®¿é—®æ—¥å¿—å®¡è®¡è¿½è¸ª

#### ä¸­é—´äººæ”»å‡»å¨èƒ
**å¨èƒæè¿°**: é€šè¿‡è¯ä¹¦ä¼ªé€ æ‹¦æˆªé€šä¿¡
**é£é™©ç­‰çº§**: é«˜
**åº”å¯¹æªæ–½**:
- Realityåè®®å†…ç½®è¯ä¹¦éªŒè¯
- è¯ä¹¦å›ºå®š(Certificate Pinning)
- å¤šé‡èº«ä»½éªŒè¯æœºåˆ¶
- å¼‚å¸¸è¿æ¥æ£€æµ‹å‘Šè­¦

---

## H. åˆè§„æ€§è€ƒè™‘

### æ•°æ®ä¿æŠ¤åˆè§„

#### GDPRåˆè§„è¦ç‚¹
```bash
# ä¸ªäººæ•°æ®æœ€å°åŒ–
- ä¸è®°å½•ç”¨æˆ·çœŸå®IPåœ°å€
- è¿æ¥æ—¥å¿—ä»…ä¿ç•™æŠ€æœ¯å¿…éœ€ä¿¡æ¯
- ç”¨æˆ·æœ‰æƒåˆ é™¤æ‰€æœ‰ç›¸å…³æ•°æ®
- æ•°æ®å¤„ç†ç›®çš„æ˜ç¡®ä¸”å¿…è¦

# æŠ€æœ¯å®ç°
implement_gdpr_compliance() {
    # IPåœ°å€åŒ¿ååŒ–
    anonymize_ip_addresses
    
    # æ•°æ®ä¿ç•™æœŸé™æ§åˆ¶
    set_data_retention_period 7  # 7å¤©
    
    # ç”¨æˆ·æ•°æ®åˆ é™¤æ¥å£
    provide_data_deletion_api
    
    # æ•°æ®å¤„ç†é€æ˜åº¦
    generate_privacy_notice
}
```

#### æœ¬åœ°æ³•è§„é€‚é…
```bash
# ä¸åŒåœ°åŒºçš„åˆè§„è¦æ±‚
COMPLIANCE_REGIONS=(
    "EU:GDPR"           # æ¬§ç›Ÿé€šç”¨æ•°æ®ä¿æŠ¤æ¡ä¾‹
    "US:CCPA"           # åŠ å·æ¶ˆè´¹è€…éšç§æ³•æ¡ˆ
    "CN:PIPL"           # ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•
    "JP:APPI"           # ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•
)

adapt_to_local_regulations() {
    local region="$1"
    
    case "$region" in
        "EU")
            enable_gdpr_mode
            ;;
        "US") 
            enable_ccpa_mode
            ;;
        "CN")
            enable_pipl_mode
            ;;
    esac
}
```

---

## I. å¼€å‘è€…æŒ‡å—

### ä»£ç è´¡çŒ®è§„èŒƒ

#### Gitå·¥ä½œæµ
```bash
# åˆ†æ”¯å‘½åè§„èŒƒ
feature/security-reality-rotation     # æ–°åŠŸèƒ½å¼€å‘
bugfix/sni-selection-timeout         # é—®é¢˜ä¿®å¤
hotfix/critical-cert-renewal         # ç´§æ€¥ä¿®å¤
docs/api-documentation-update        # æ–‡æ¡£æ›´æ–°

# æäº¤ä¿¡æ¯æ ¼å¼
git commit -m "feat(security): add Reality key rotation system

- Implement automatic key rotation every 90 days
- Add notification system for upcoming rotations  
- Include rollback mechanism for failed rotations
- Update edgeboxctl with rotation commands

Closes: #123
Reviewed-by: @reviewer"
```

#### ä»£ç è´¨é‡æ ‡å‡†
```bash
# Shellè„šæœ¬è§„èŒƒæ£€æŸ¥
shellcheck *.sh
shfmt -i 4 -w *.sh

# æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
bash_unit tests/
coverage_percentage=$(get_test_coverage)
if [[ $coverage_percentage -lt 80 ]]; then
    echo "æµ‹è¯•è¦†ç›–ç‡ä¸è¶³: $coverage_percentage%"
    exit 1
fi

# å®‰å…¨æ‰«æ
bandit -r scripts/
semgrep --config=security scripts/
```

### æ‰©å±•å¼€å‘æŒ‡å—

#### æ–°åè®®æ”¯æŒ
```bash
# æ·»åŠ æ–°åè®®æ”¯æŒçš„æ­¥éª¤
1. åœ¨åè®®æ¨¡å—ä¸­å®šä¹‰é…ç½®ç»“æ„
2. å®ç°åè®®ç‰¹å®šçš„éšæœºåŒ–å‚æ•°
3. æ·»åŠ å¥åº·æ£€æŸ¥æœºåˆ¶
4. é›†æˆåˆ°ä¸»é…ç½®æµç¨‹
5. ç¼–å†™å•å…ƒæµ‹è¯•
6. æ›´æ–°æ–‡æ¡£

# ç¤ºä¾‹: æ·»åŠ æ–°åè®® "NewProtocol"
add_new_protocol_support() {
    # 1. å®šä¹‰é…ç½®æ¨¡æ¿
    create_protocol_template "NewProtocol"
    
    # 2. å®ç°éšæœºåŒ–
    implement_randomization "NewProtocol"
    
    # 3. æ·»åŠ å¥åº·æ£€æŸ¥
    add_health_check "NewProtocol"
    
    # 4. é›†æˆé…ç½®ç”Ÿæˆ
    integrate_config_generation "NewProtocol"
    
    # 5. æ·»åŠ edgeboxctlå‘½ä»¤
    add_ctl_commands "NewProtocol"
}
```

#### æ’ä»¶æ¶æ„
```bash
# æ’ä»¶å¼€å‘æ¡†æ¶
PLUGIN_DIR="/etc/edgebox/plugins"
PLUGIN_API_VERSION="1.0"

# æ’ä»¶æ¥å£å®šä¹‰
plugin_interface() {
    cat << 'EOF'
#!/bin/bash
# EdgeBoxæ’ä»¶æ¥å£è§„èŒƒ

# å¿…éœ€å‡½æ•°
plugin_init() {
    # æ’ä»¶åˆå§‹åŒ–
    echo "Plugin initialized"
}

plugin_execute() {
    local action="$1"
    local params="$2"
    
    # æ’ä»¶ä¸»è¦åŠŸèƒ½
    case "$action" in
        "start") plugin_start "$params" ;;
        "stop") plugin_stop "$params" ;;
        "status") plugin_status ;;
    esac
}

plugin_cleanup() {
    # æ’ä»¶æ¸…ç†
    echo "Plugin cleaned up"
}

# æ’ä»¶å…ƒæ•°æ®
PLUGIN_NAME="example-plugin"
PLUGIN_VERSION="1.0.0"
PLUGIN_DESCRIPTION="ç¤ºä¾‹æ’ä»¶"
PLUGIN_AUTHOR="EdgeBox Team"
EOF
}
```

---

## J. ç¤¾åŒºä¸æ”¯æŒ

### æŠ€æœ¯æ”¯æŒæ¸ é“

#### å®˜æ–¹æ”¯æŒ
- **æ–‡æ¡£ç«™**: https://docs.edgebox.io
- **é—®é¢˜è¿½è¸ª**: https://github.com/edgebox/issues
- **å®‰å…¨æŠ¥å‘Š**: security@edgebox.io
- **æŠ€æœ¯è®ºå›**: https://forum.edgebox.io

#### ç¤¾åŒºèµ„æº
- **ç”¨æˆ·ç¾¤ç»„**: Telegram/Discordç¤¾åŒº
- **ä»£ç ä»“åº“**: GitHubå¼€æºé¡¹ç›®
- **çŸ¥è¯†åº“**: Wikiæ–‡æ¡£é›†åˆ
- **è§†é¢‘æ•™ç¨‹**: YouTubeå®˜æ–¹é¢‘é“

### è´¡çŒ®æŒ‡å—

#### å¦‚ä½•è´¡çŒ®
1. **ä»£ç è´¡çŒ®**: æäº¤Pull Requestä¿®å¤é—®é¢˜æˆ–æ·»åŠ åŠŸèƒ½
2. **æ–‡æ¡£æ”¹è¿›**: å®Œå–„æ–‡æ¡£ã€æ·»åŠ ç¤ºä¾‹ã€ç¿»è¯‘å†…å®¹
3. **é—®é¢˜æŠ¥å‘Š**: è¯¦ç»†æè¿°é‡åˆ°çš„é—®é¢˜å’Œå¤ç°æ­¥éª¤
4. **åŠŸèƒ½å»ºè®®**: æå‡ºæ–°åŠŸèƒ½éœ€æ±‚å’Œæ”¹è¿›å»ºè®®
5. **æµ‹è¯•åé¦ˆ**: å‚ä¸Betaæµ‹è¯•å¹¶æä¾›åé¦ˆ

#### ä»£ç è´¡çŒ®æµç¨‹
```bash
# 1. Forké¡¹ç›®
git clone https://github.com/yourusername/edgebox.git

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/your-feature-name

# 3. è¿›è¡Œå¼€å‘å’Œæµ‹è¯•
make test
make lint

# 4. æäº¤ä»£ç 
git commit -m "feat: add your feature description"
git push origin feature/your-feature-name

# 5. åˆ›å»ºPull Request
# åœ¨GitHubä¸Šåˆ›å»ºPRå¹¶å¡«å†™è¯¦ç»†æè¿°
```

---

## K. ç‰ˆæœ¬å†å²ä¸æ›´æ–°æ—¥å¿—

### ç‰ˆæœ¬è§„åˆ’

#### v3.1.0 (è®¡åˆ’ä¸­)
**å‘å¸ƒæ—¶é—´**: 2025å¹´Q2
**ä¸»è¦åŠŸèƒ½**:
- Realityå¯†é’¥è‡ªåŠ¨è½®æ¢ç³»ç»Ÿ
- SNIåŸŸåæ± æ™ºèƒ½ç®¡ç†
- åŸºç¡€æµé‡éšæœºåŒ–åŠŸèƒ½
- æ”¹è¿›çš„ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

#### v3.2.0 (è®¡åˆ’ä¸­)  
**å‘å¸ƒæ—¶é—´**: 2025å¹´Q3
**ä¸»è¦åŠŸèƒ½**:
- é«˜çº§æµé‡åˆ†æå¯¹æŠ—
- å¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡æ”¯æŒ
- ç§»åŠ¨ç½‘ç»œä¼˜åŒ–
- AIé©±åŠ¨çš„å‚æ•°è‡ªé€‚åº”

#### v3.3.0 (è®¡åˆ’ä¸­)
**å‘å¸ƒæ—¶é—´**: 2025å¹´Q4  
**ä¸»è¦åŠŸèƒ½**:
- é›¶æ—¥å¿—éšç§æ¶æ„
- åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ
- é«˜çº§å¨èƒæ£€æµ‹
- åˆè§„æ€§æ¡†æ¶å®Œå–„

### æ›´æ–°ç­–ç•¥

#### å®‰å…¨æ›´æ–°
- **å…³é”®å®‰å…¨ä¿®å¤**: 24å°æ—¶å†…å‘å¸ƒ
- **ä¸€èˆ¬å®‰å…¨æ”¹è¿›**: 7å¤©å†…å‘å¸ƒ  
- **å®‰å…¨å…¬å‘Š**: é€šè¿‡å¤šæ¸ é“åŠæ—¶é€šçŸ¥

#### åŠŸèƒ½æ›´æ–°
- **é‡å¤§åŠŸèƒ½**: å­£åº¦å‘å¸ƒå‘¨æœŸ
- **å°åŠŸèƒ½æ”¹è¿›**: æœˆåº¦å‘å¸ƒå‘¨æœŸ
- **é—®é¢˜ä¿®å¤**: åŒå‘¨å‘å¸ƒå‘¨æœŸ

---

## ç»“è¯­

æœ¬æŠ€æœ¯æ–‡æ¡£ä¸ºEdgeBoxå®‰å…¨æ”¹è¿›æä¾›äº†å…¨é¢çš„å®æ–½æŒ‡å¯¼ï¼Œæ¶µç›–äº†ä»æ ¸å¿ƒå®‰å…¨åŠŸèƒ½åˆ°è¿ç»´ç›‘æ§çš„å„ä¸ªæ–¹é¢ã€‚é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æŠ€æœ¯æ–¹æ¡ˆå’Œæœ€ä½³å®è·µï¼Œå¯ä»¥æ˜¾è‘—æå‡EdgeBoxç³»ç»Ÿçš„å®‰å…¨æ€§ã€å¯é æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

### æ ¸å¿ƒä»·å€¼
- **å®‰å…¨ç¬¬ä¸€**: ä»¥ç°ä»£å¯†ç å­¦å’Œç½‘ç»œå®‰å…¨ç†è®ºä¸ºåŸºç¡€
- **ç”¨æˆ·å‹å¥½**: æœ€å°åŒ–å¯¹ç”¨æˆ·ä½¿ç”¨ä½“éªŒçš„å½±å“
- **è‡ªåŠ¨åŒ–**: å‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜ç³»ç»Ÿå¯é æ€§
- **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•

### å®æ–½å»ºè®®
1. **é˜¶æ®µæ€§å®æ–½**: æŒ‰ä¼˜å…ˆçº§åˆ†é˜¶æ®µå®æ–½å„é¡¹æ”¹è¿›
2. **å……åˆ†æµ‹è¯•**: æ¯é¡¹åŠŸèƒ½éƒ½è¦ç»è¿‡å…¨é¢æµ‹è¯•éªŒè¯
3. **æ–‡æ¡£åŒæ­¥**: ä¿æŒä»£ç å®ç°ä¸æ–‡æ¡£çš„åŒæ­¥æ›´æ–°
4. **ç¤¾åŒºåé¦ˆ**: ç§¯ææ”¶é›†å’Œå“åº”ç”¨æˆ·åé¦ˆæ„è§

### æŒç»­æ”¹è¿›
EdgeBoxçš„å®‰å…¨æ”¹è¿›æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å¨èƒç¯å¢ƒçš„å˜åŒ–ã€æŠ€æœ¯çš„å‘å±•å’Œç”¨æˆ·éœ€æ±‚çš„æ¼”è¿›ä¸æ–­è°ƒæ•´å’Œä¼˜åŒ–ã€‚æˆ‘ä»¬é¼“åŠ±å¼€å‘è€…å’Œç”¨æˆ·ç§¯æå‚ä¸åˆ°è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå…±åŒæ‰“é€ æ›´åŠ å®‰å…¨ã€å¯é çš„éšç§ä¿æŠ¤å·¥å…·ã€‚

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æœ€åæ›´æ–°**: 2025å¹´  
**ä¸‹æ¬¡å®¡æŸ¥**: 2025å¹´Q2  
**ç»´æŠ¤è€…**: EdgeBoxå¼€å‘å›¢é˜Ÿ
